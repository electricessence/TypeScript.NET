{"version":3,"sources":["System/Threading/NodeJSWorker.ts"],"names":[],"mappings":";;;;QASM,SAAS,EAET,EAAE;;;;;;;;;;YAFF,SAAS,GAAG,iBAAe,CAAC;YAE5B,EAAE,GAAS,OAAQ,CAAC,eAAe,CAAC,CAAC;YAM3C;gBAAkC,gCAAmB;gBAMpD,sBAAY,GAAU;oBANvB,iBAgDC;oBAxCC,iBAAO,CAAC;oBACR,IAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;oBAC7C,OAAO,CAAC,EAAE,CAAC,SAAS,EAAE,UAAC,GAAU,IAAG,OAAA,KAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAA7B,CAA6B,CAAC,CAAC;oBACnE,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,GAAO,IAAG,OAAA,KAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAlB,CAAkB,CAAC,CAAC;gBACpD,CAAC;gBAES,8BAAO,GAAjB,UAAkB,IAAQ;oBAEzB,gBAAK,CAAC,OAAO,YAAC,IAAI,CAAC,CAAC;oBACpB,EAAE,CAAA,CAAC,IAAI,CAAC,SAAS,CAAC;wBACjB,IAAI,CAAC,SAAS,CAAC,EAAC,IAAI,EAAE,IAAI,EAAC,CAAC,CAAC;gBAE/B,CAAC;gBAES,+BAAQ,GAAlB,UAAmB,KAAS;oBAE3B,gBAAK,CAAC,QAAQ,YAAC,KAAK,CAAC,CAAC;oBACtB,EAAE,CAAA,CAAC,IAAI,CAAC,OAAO,CAAC;wBACf,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;gBACtB,CAAC;gBAES,iCAAU,GAApB;oBAEC,gBAAK,CAAC,UAAU,WAAE,CAAC;oBACnB,IAAI,CAAC,QAAQ,CAAC,kBAAkB,EAAE,CAAC;oBACnC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;oBACrB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;gBACtB,CAAC;gBAED,kCAAW,GAAX,UAAY,GAAO;oBAElB,IAAI,CAAC,eAAe,EAAE,CAAC;oBACvB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,EAAC,IAAI,EAAE,GAAG,EAAC,CAAC,CAAC,CAAC;gBACjD,CAAC;gBAED,gCAAS,GAAT;oBAEC,IAAI,CAAC,OAAO,EAAE,CAAC;gBAChB,CAAC;gBAEF,mBAAC;YAAD,CAhDA,AAgDC,CAhDiC,+BAAc,GAgD/C;YAhDD,uCAgDC,CAAA;YAED,oBAAe,YAAY,EAAC","file":"NodeJSWorker.js","sourcesContent":["/*!\r\n * @author electricessence / https://github.com/electricessence/\r\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\r\n * Based upon Parallel.js: https://github.com/adambom/parallel.js/blob/master/lib/Worker.js\r\n */\r\nimport {WorkerLike} from \"./WorkerType\";\r\nimport {ObservableBase} from \"../Observable/ObservableBase\";\r\nimport __extendsImport from \"../../extends\";\r\n// noinspection JSUnusedLocalSymbols\r\nconst __extends = __extendsImport;\r\n\r\nconst ps = (<any>require)(\"child_process\");\r\n//import {ChildProcess} from \"child_process\";\r\n\r\n/**\r\n * This class takes the place of a WebWorker\r\n */\r\nexport class NodeJSWorker extends ObservableBase<any> implements WorkerLike\r\n{\r\n\tprivate _process:any;\r\n\tonmessage:(message:{data:any})=>void;\r\n\tonerror:(error:any)=>void;\r\n\r\n\tconstructor(url:string)\r\n\t{\r\n\t\tsuper();\r\n\t\tconst process = this._process = ps.fork(url);\r\n\t\tprocess.on('message', (msg:string)=>this._onNext(JSON.parse(msg)));\r\n\t\tprocess.on('error', (err:any)=>this._onError(err));\r\n\t}\r\n\r\n\tprotected _onNext(data:any):void\r\n\t{\r\n\t\tsuper._onNext(data);\r\n\t\tif(this.onmessage)\r\n\t\t\tthis.onmessage({data: data});\r\n\r\n\t}\r\n\r\n\tprotected _onError(error:any):void\r\n\t{\r\n\t\tsuper._onError(error);\r\n\t\tif(this.onerror)\r\n\t\t\tthis.onerror(error);\r\n\t}\r\n\r\n\tprotected _onDispose()\r\n\t{\r\n\t\tsuper._onDispose();\r\n\t\tthis._process.removeAllListeners(); // just to satisfy paranoia.\r\n\t\tthis._process.kill();\r\n\t\tthis._process = null;\r\n\t}\r\n\r\n\tpostMessage(obj:any):void\r\n\t{\r\n\t\tthis.throwIfDisposed();\r\n\t\tthis._process.send(JSON.stringify({data: obj}));\r\n\t}\r\n\r\n\tterminate()\r\n\t{\r\n\t\tthis.dispose();\r\n\t}\r\n\r\n}\r\n\r\nexport default NodeJSWorker;\r\n"]}