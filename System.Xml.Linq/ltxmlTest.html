<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
</head>
<body>
<pre>
<script src="linq.js" type="text/javascript"></script>
<script src="ltxml.js" type="text/javascript"></script>
<script type="text/javascript">

    bucketTimer = {};

    bucketTimer.init = function () {
        var prop;

        bucketTimer.currentTime = (new Date()).getTime();
        bucketTimer.beginningTime = bucketTimer.currentTime;
        bucketTimer.currentBucket = '';
        for (prop in bucketTimer) {
            if (typeof bucketTimer[prop] !== 'function' &&
                        prop !== 'currentTime' &&
                        prop !== 'currentBucket' &&
                        prop !== 'beginningTime') {
                delete bucketTimer[prop];
            }
        }
    };

    bucketTimer.bucket = function (b) {
        var ct, diff, z;

        ct = (new Date()).getTime();
        diff = ct - bucketTimer.currentTime;
        if (bucketTimer.currentBucket !== '') {
            if (bucketTimer[bucketTimer.currentBucket]) {
                bucketTimer[bucketTimer.currentBucket].time += diff;
                bucketTimer[bucketTimer.currentBucket].count += 1;
            }
            else {
                z = {};
                z.time = diff;
                z.count = 1;
                bucketTimer[bucketTimer.currentBucket] = z;
            }
        }
        bucketTimer.currentTime = ct;
        bucketTimer.currentBucket = b;
    };

    String.prototype.lPad = function (PadLength, PadChar) {
        //Use: String.lPad(Number of Characters, Character to Pad)
        //Returns: string with the PadChar appended to the left until the string
        // is PadLength in length
        var p = Math.max((PadLength + 1) - this.length, 0);
        return Array(p).join(PadChar) + this;  //ignore jslint
    };

    String.prototype.rPad = function (PadLength, PadChar) {
        //Use: String.rPad(Number of Characters, Character to Pad)
        //Returns: string with the PadChar appended to the right until the string 
        // is PadLength in length
        var p = Math.max((PadLength + 1) - this.length, 0);  //ignore jslint
        return this + Array(p).join(PadChar);  //ignore jslint
    };

    bucketTimer.dump = function () {
        var prop, s, a, a2, a3, a4, diffFromBeginning, i;

        bucketTimer.bucket('');
        s = '';
        a = [];
        for (prop in bucketTimer) {
            if (typeof bucketTimer[prop] !== 'function' &&
                        prop !== 'currentTime' &&
                        prop !== 'currentBucket' &&
                        prop !== 'beginningTime') {
                a.push(prop.toString().rPad(50, "-") + ': ' +
                    bucketTimer[prop].time.toString().lPad(8, " ") +
                    " " + bucketTimer[prop].count.toString().lPad(8, " "));
            }
        }
        a2 = Enumerable.from(a);
        a3 = a2.orderBy("z=>z");
        a4 = a3.toArray();
        for (i = 0; i < a4.length; i += 1) {
            s += a4[i] + '\n';
        }

        diffFromBeginning = bucketTimer.currentTime - bucketTimer.beginningTime;
        s += "total time: " + diffFromBeginning + "\n";
        return s;
    };

    (function (root) {  // root = global
        "use strict";

        var XAttribute = Ltxml.XAttribute;
        var XCData = Ltxml.XCData;
        var XComment = Ltxml.XComment;
        var XContainer = Ltxml.XContainer;
        var XDeclaration = Ltxml.XDeclaration;
        var XDocument = Ltxml.XDocument;
        var XElement = Ltxml.XElement;
        var XName = Ltxml.XName;
        var XNamespace = Ltxml.XNamespace;
        var XNode = Ltxml.XNode;
        var XObject = Ltxml.XObject;
        var XProcessingInstruction = Ltxml.XProcessingInstruction;
        var XText = Ltxml.XText;
        var XEntity = Ltxml.XEntity;
        var XEnumerable = Ltxml.XEnumerable;

        // If you want to retain more close idioms to LINQ to XML, then you can set the following (which
        // 'polutes' the Enumerable class with additional methods that do not apply to all Enumerable instances,
        // yet will show up in Intellisense for all instances.  Tests 136 - 148 show the use of this idiom.
        // Earlier tests show the use of the asXEnumerable method.
        Enumerable.prototype.elements = Ltxml.XEnumerable.prototype.elements;
        Enumerable.prototype.ancestors = Ltxml.XEnumerable.prototype.ancestors;
        Enumerable.prototype.ancestorsAndSelf = Ltxml.XEnumerable.prototype.ancestorsAndSelf;
        Enumerable.prototype.attributes = Ltxml.XEnumerable.prototype.attributes;
        Enumerable.prototype.descendantNodes = Ltxml.XEnumerable.prototype.descendantNodes;
        Enumerable.prototype.descendantNodesAndSelf = Ltxml.XEnumerable.prototype.descendantNodesAndSelf;
        Enumerable.prototype.descendants = Ltxml.XEnumerable.prototype.descendants;
        Enumerable.prototype.descendantsAndSelf = Ltxml.XEnumerable.prototype.descendantsAndSelf;
        Enumerable.prototype.elements = Ltxml.XEnumerable.prototype.elements;
        Enumerable.prototype.nodes = Ltxml.XEnumerable.prototype.nodes;
        Enumerable.prototype.remove = Ltxml.XEnumerable.prototype.remove;

        // if using JQuery
        // Enumerable = $.Enumerable;

        if (!Array.isArray) {
            Array.isArray = function (arg) {
                return Object.prototype.toString.call(arg) == '[object Array]'; //ignore jslint
            };
        }

        var parseXml;

        if (typeof window.DOMParser != "undefined") {
            parseXml = function (xmlStr) {
                return (new window.DOMParser()).parseFromString(xmlStr, "text/xml");
            };
        } else if (typeof window.ActiveXObject != "undefined" &&
               new window.ActiveXObject("Microsoft.XMLDOM")) {
            parseXml = function (xmlStr) {
                var xmlDoc = new window.ActiveXObject("Microsoft.XMLDOM");
                xmlDoc.async = "false";
                xmlDoc.loadXML(xmlStr);
                return xmlDoc;
            };
        } else {
            throw new Error("No XML parser found");
        }

        function dumpObject(obj, depth) {
            var o = '';
            if (isNaN(depth))
                depth = 0;
            var prop;
            for (prop in obj) {
                if (Array.isArray(obj[prop])) {
                    o += (Ltxml.spaces.substring(0, depth * 2) + prop + ":") + '\n';
                    depth += 1;
                    for (var i = 0; i < obj[prop].length; i++) {
                        if (typeof obj[prop][i] === 'object') {
                            o += (Ltxml.spaces.substring(0, depth * 2) + 'object:') + '\n';
                            o += dumpObject(obj[prop][i], depth + 1);
                        } else {
                            o += (Ltxml.spaces.substring(0, depth * 2) + obj[prop][i]) + '\n';
                        }
                    }
                    depth -= 1;
                }
                else if (typeof obj[prop] !== 'function') {
                    if (typeof obj[prop] === 'object') {
                        if (prop === 'parent') {
                            o += (Ltxml.spaces.substring(0, depth * 2) + prop) + '\n';
                        }
                        else {
                            o += (Ltxml.spaces.substring(0, depth * 2) + prop + ":") + '\n';
                            o += dumpObject(obj[prop], depth + 1);
                        }
                    } else {
                        o += (Ltxml.spaces.substring(0, depth * 2) + prop + ":" + obj[prop]) + '\n';
                    }
                }
            }
            return o;
        }

        function dumpTables() {
            var o = '';
            o += '\n';
            o += "Namespaces" + '\n';
            o += "==========" + '\n';
            o += dumpObject(Ltxml.namespaceCache);
            o += '\n';
            o += "Names" + '\n';
            o += "=====" + '\n';
            o += dumpObject(Ltxml.nameCache);
            return o;
        }

        function convertToEntities(str) {
            var ns = str.replace(/\</g, "&lt;");
            ns = ns.replace(/\>/g, "&gt;");
            return ns;
        }

        function checkParentage(container) {
            var i;
            var j;
            var rv;

            if (container._attributes) {
                for (i = 0; i < container._attributes.length; i++) {
                    if (container._attributes[i].parent !== container) {
                        return "******************** Invalid Parent ********************";
                    }
                }
            }
            for (j = 0; j < container.nodesArray.length; j++) {
                if (container.nodesArray[j].parent !== container) {
                    return "******************** Invalid Parent ********************";
                }
                if (container.nodesArray[j].nodeType === 'Element') {
                    rv = checkParentage(container.nodesArray[j]);
                    if (rv !== '')
                        return rv;
                }
            }
            return '';
        }

        var tests = [
            {
                testNum: 1,
                testFunc: function () {
                    var ns1 = XNamespace.getNone();
                    var e = new XNamespace("http://www.ericwhite.com");

                    var n1 = new XName(ns1, "boo");
                    var n2 = new XName(ns1, "yar");
                    var n3 = new XName(ns1, "baz");
                    var n4 = new XName(ns1, "boo");
                    var n5 = new XName(ns1, "yar");
                    var n6 = new XName(ns1, "yar");

                    var e1 = new XName(e, "boo");
                    var e2 = new XName(e, "yar");
                    var e3 = new XName(e, "baz");
                    var e4 = new XName(e, "boo");
                    var e5 = new XName(e, "yar");
                    var e6 = new XName(e, "yar");

                    var f1 = new XElement(e + "boo", new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName));
                    var f2 = new XElement(f1);
                    var o = '';

                    o += (f1.XName === f2.XName) + '\n';
                    var f3 = new XElement(f2);
                    o += (f3.XName === e2) + '\n';

                    o += f1.toString() + '\n';
                    o += f2.toString() + '\n';

                    o += "===========================" + '\n';
                    var o2 = dumpTables();
                    o = o + o2;
                    return o;
                },
                output:
                    'true\n' +
                    'false\n' +
                    '<e:boo xmlns:e=\'http://www.ericwhite.com\'/>\n' +
                    '<e:boo xmlns:e=\'http://www.ericwhite.com\'/>\n' +
                    '===========================\n' +
                    '\n' +
                    'Namespaces\n' +
                    '==========\n' +
                    '__none:\n' +
                    '  namespaceName:__none\n' +
                    '  preferredPrefix:\n' +
                    'http://www.ericwhite.com:\n' +
                    '  namespaceName:http://www.ericwhite.com\n' +
                    '  preferredPrefix:e\n' +
                    'http://www.w3.org/2000/xmlns/:\n' +
                    '  namespaceName:http://www.w3.org/2000/xmlns/\n' +
                    '  preferredPrefix:xmlns\n' +
                    'http://www.w3.org/XML/1998/namespace:\n' +
                    '  namespaceName:http://www.w3.org/XML/1998/namespace\n' +
                    '  preferredPrefix:xml\n' +
                    '\n' +
                    'Names\n' +
                    '=====\n' +
                    '{__none}boo:\n' +
                    '  namespace:\n' +
                    '    namespaceName:__none\n' +
                    '    preferredPrefix:\n' +
                    '  namespaceName:__none\n' +
                    '  localName:boo\n' +
                    '{__none}yar:\n' +
                    '  namespace:\n' +
                    '    namespaceName:__none\n' +
                    '    preferredPrefix:\n' +
                    '  namespaceName:__none\n' +
                    '  localName:yar\n' +
                    '{__none}baz:\n' +
                    '  namespace:\n' +
                    '    namespaceName:__none\n' +
                    '    preferredPrefix:\n' +
                    '  namespaceName:__none\n' +
                    '  localName:baz\n' +
                    '{http://www.ericwhite.com}boo:\n' +
                    '  namespace:\n' +
                    '    namespaceName:http://www.ericwhite.com\n' +
                    '    preferredPrefix:e\n' +
                    '  namespaceName:http://www.ericwhite.com\n' +
                    '  localName:boo\n' +
                    '{http://www.ericwhite.com}yar:\n' +
                    '  namespace:\n' +
                    '    namespaceName:http://www.ericwhite.com\n' +
                    '    preferredPrefix:e\n' +
                    '  namespaceName:http://www.ericwhite.com\n' +
                    '  localName:yar\n' +
                    '{http://www.ericwhite.com}baz:\n' +
                    '  namespace:\n' +
                    '    namespaceName:http://www.ericwhite.com\n' +
                    '    preferredPrefix:e\n' +
                    '  namespaceName:http://www.ericwhite.com\n' +
                    '  localName:baz\n' +
                    '{http://www.w3.org/2000/xmlns/}e:\n' +
                    '  namespace:\n' +
                    '    namespaceName:http://www.w3.org/2000/xmlns/\n' +
                    '    preferredPrefix:xmlns\n' +
                    '  namespaceName:http://www.w3.org/2000/xmlns/\n' +
                    '  localName:e'
            },
            {
                testNum: 2,
                testFunc: function () {
                    var ns1 = XNamespace.getNone();
                    var e = XNamespace("http://www.ericwhite.com");

                    var xn = e + "boo";
                    var x = new XElement(xn,
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        "yar");
                    var o = '';
                    o += x.toString();
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:boo xmlns:e=\'http://www.ericwhite.com\'>yar</e:boo>'
            },
            {
                testNum: 3,
                testFunc: function () {
                    var ns1 = XNamespace.getNone();
                    var e = XNamespace("http://www.ericwhite.com");

                    var x = new XElement(e + "boo",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        "yar");
                    var o = '';
                    o += x.toString();
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:boo xmlns:e=\'http://www.ericwhite.com\'>yar</e:boo>'
            },
            {
                testNum: 4,
                testFunc: function () {
                    var ns1 = XNamespace.getNone();
                    var e = XNamespace("http://www.ericwhite.com");

                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XElement(e + "boo", "yar"),
                        new XElement(e + "yar", "boo"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root xmlns:e=\'http://www.ericwhite.com\'>\n' +
                    '  <e:boo>yar</e:boo>\n' +
                    '  <e:yar>boo</e:yar>\n' +
                    '</e:root>'
            },
            {
                testNum: 5,
                testFunc: function () {
                    var e = XNamespace("http://www.ericwhite.com");

                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute(e + "att", "1"),
                        new XElement(e + "boo", "yar"),
                        new XElement(e + "yar", "boo"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root e:att=\'1\'\n' +
                    '        xmlns:e=\'http://www.ericwhite.com\'>\n' +
                    '  <e:boo>yar</e:boo>\n' +
                    '  <e:yar>boo</e:yar>\n' +
                    '</e:root>'
            },
            {
                testNum: 6,
                testFunc: function () {
                    var e = XNamespace("http://www.ericwhite.com");

                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute("att", "1"),
                        new XElement(e + "boo", "yar"),
                        new XElement(e + "yar", "boo"));
                    var o = '';
                    o += x.toString();
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att=\'1\' xmlns:e=\'http://www.ericwhite.com\'><e:boo>yar</e:boo><e:yar>boo</e:yar></e:root>'
            },
            {
                testNum: 7,
                testFunc: function () {
                    var ea = [
                        new XElement('abc', 1),
                        new XElement('def', 2),
                        new XElement('ghi', 3),
                        new XElement('jkl', 4)
                    ];
                    var foo = Enumerable.from(ea).take(2);

                    var e = new XElement('root', foo);
                    var o = '';
                    o += e.toString(true);
                    o += checkParentage(e);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <abc>1</abc>\n' +
                    '  <def>2</def>\n' +
                    '</root>'
            },
            {
                testNum: 8,
                testFunc: function () {
                    // ================================ content:yes indent:yes first_child_text:yes attributes:0
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        'yar');
                    var o = '';
                    o += x.toString();
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root xmlns:e=\'http://www.ericwhite.com\'>yar</e:root>'
            },
            {
                testNum: 9,
                testFunc: function () {
                    // ================================ content:yes indent:yes first_child_text:yes attributes:1
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute('att', '123'),
                        'yar');
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att=\'123\'\n' +
                    '        xmlns:e=\'http://www.ericwhite.com\'>yar</e:root>'
            },
            {
                testNum: 10,
                testFunc: function () {
                    // ================================ content:yes indent:yes first_child_text:yes attributes:*
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute("att", 1),
                        new XAttribute("att2", 2),
                        'yar');
                    var o = ''
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att=\'1\'\n' +
                    '        att2=\'2\'\n' +
                    '        xmlns:e=\'http://www.ericwhite.com\'>yar</e:root>'
            },
            {
                testNum: 11,
                testFunc: function () {
                    // ================================ content:yes indent:yes first_child_text:yes attributes:*
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute("att", 1),
                        new XAttribute("att2", 2),
                        new XAttribute("att3", 3),
                        'yar');
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att=\'1\'\n' +
                    '        att2=\'2\'\n' +
                    '        att3=\'3\'\n' +
                    '        xmlns:e=\'http://www.ericwhite.com\'>yar</e:root>'
            },
            {
                testNum: 12,
                testFunc: function () {
                    // ================================ content:yes indent:yes first_child_text:yes attributes:*
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute("att", 1),
                        new XAttribute("att2", 2),
                        new XAttribute("att3", 3),
                        new XAttribute("att4", 4),
                        'yar');
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att=\'1\'\n' +
                    '        att2=\'2\'\n' +
                    '        att3=\'3\'\n' +
                    '        att4=\'4\'\n' +
                    '        xmlns:e=\'http://www.ericwhite.com\'>yar</e:root>'
            },
            {
                testNum: 13,
                testFunc: function () {
                    // ================================ content:yes indent:yes first_child_text:no attributes:0
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XElement(e + "child", "123"),
                        new XElement(e + "child", "456"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root xmlns:e=\'http://www.ericwhite.com\'>\n' +
                    '  <e:child>123</e:child>\n' +
                    '  <e:child>456</e:child>\n' +
                    '</e:root>'
            },
            {
                testNum: 14,
                testFunc: function () {
                    // ================================ content:yes indent:yes first_child_text:no attributes:1
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute("att45", 1234),
                        new XElement(e + "child", "123"),
                        new XElement(e + "child", "456"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att45=\'1234\'\n' +
                    '        xmlns:e=\'http://www.ericwhite.com\'>\n' +
                    '  <e:child>123</e:child>\n' +
                    '  <e:child>456</e:child>\n' +
                    '</e:root>'
            },
            {
                testNum: 15,
                testFunc: function () {
                    // ================================ content:yes indent:yes first_child_text:no attributes:*
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute("att45", 1234),
                        new XAttribute("att12", "abcde"),
                        new XElement(e + "child", "123"),
                        new XElement(e + "child", "456"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att12=\'abcde\'\n' +
                    '        att45=\'1234\'\n' +
                    '        xmlns:e=\'http://www.ericwhite.com\'>\n' +
                    '  <e:child>123</e:child>\n' +
                    '  <e:child>456</e:child>\n' +
                    '</e:root>'
            },
            {
                testNum: 16,
                testFunc: function () {
                    // ================================ content:yes indent:yes first_child_text:no attributes:*
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute("att45", 1234),
                        new XAttribute("att12", "abcde"),
                        new XAttribute("qwer", "ty"),
                        new XElement(e + "child", "123"),
                        new XElement(e + "child", "456"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att12=\'abcde\'\n' +
                    '        att45=\'1234\'\n' +
                    '        qwer=\'ty\'\n' +
                    '        xmlns:e=\'http://www.ericwhite.com\'>\n' +
                    '  <e:child>123</e:child>\n' +
                    '  <e:child>456</e:child>\n' +
                    '</e:root>'
            },
            {
                testNum: 17,
                testFunc: function () {
                    // ================================ content:yes indent:yes first_child_text:no attributes:*
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute("att45", 1234),
                        new XAttribute("att12", "abcde"),
                        new XAttribute("qwer", "ty"),
                        new XAttribute("att12a", "abcde"),
                        new XAttribute("qwerb", "ty"),
                        new XElement(e + "child", "123"),
                        new XElement(e + "child", "456"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att12=\'abcde\'\n' +
                    '        att12a=\'abcde\'\n' +
                    '        att45=\'1234\'\n' +
                    '        qwer=\'ty\'\n' +
                    '        qwerb=\'ty\'\n' +
                    '        xmlns:e=\'http://www.ericwhite.com\'>\n' +
                    '  <e:child>123</e:child>\n' +
                    '  <e:child>456</e:child>\n' +
                    '</e:root>'
            },
            {
                testNum: 18,
                testFunc: function () {
                    // ================================ content:yes indent:no
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute("att45", 1234),
                        new XAttribute("att12", "abcde"),
                        new XAttribute("qwer", "ty"),
                        new XAttribute("att12a", "abcde"),
                        new XAttribute("qwerb", "ty"),
                        new XElement(e + "child", "123"),
                        new XElement(e + "child", "456"));
                    var o = '';
                    o += x.toString(false);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att12=\'abcde\' att12a=\'abcde\' att45=\'1234\' qwer=\'ty\' qwerb=\'ty\' xmlns:e=\'http://www.ericwhite.com\'><e:child>123</e:child><e:child>456</e:child></e:root>'
            },
            {
                testNum: 19,
                testFunc: function () {
                    // ================================ content:no indent:no
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute("att45", 1234),
                        new XAttribute("att12", "abcde"),
                        new XAttribute("qwer", "ty"),
                        new XAttribute(e + "att12a", "abcde"),
                        new XAttribute("qwerb", "ty"));
                    var o = '';
                    o += x.toString(false);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att12=\'abcde\' att45=\'1234\' qwer=\'ty\' qwerb=\'ty\' e:att12a=\'abcde\' xmlns:e=\'http://www.ericwhite.com\'/>'
            },
            {
                testNum: 20,
                testFunc: function () {
                    // ================================ content:no indent:yes attributes:no
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName)
                    );
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root xmlns:e=\'http://www.ericwhite.com\'/>'
            },
            {
                testNum: 21,
                testFunc: function () {
                    // ================================ content:no indent:yes attributes:no
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XElement(e + "child"),
                        new XElement("child2"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root xmlns:e=\'http://www.ericwhite.com\'>\n' +
                    '  <e:child/>\n' +
                    '  <child2/>\n' +
                    '</e:root>'
            },
            {
                testNum: 22,
                testFunc: function () {
                    // ================================ content:no indent:yes attributes:1
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute("att", "value"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att=\'value\'\n' +
                    '        xmlns:e=\'http://www.ericwhite.com\'/>'
            },
            {
                testNum: 23,
                testFunc: function () {
                    // ================================ content:no indent:yes attributes:*
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute("att45", 1234),
                        new XAttribute("att12", "abcde"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att12=\'abcde\'\n' +
                    '        att45=\'1234\'\n' +
                    '        xmlns:e=\'http://www.ericwhite.com\'/>'
            },
            {
                testNum: 24,
                testFunc: function () {
                    // ================================ content:no indent:yes attributes:*
                    var e = XNamespace("http://www.ericwhite.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute("att45", 1234),
                        new XAttribute("qwer", 'ty'),
                        new XAttribute("att99", 1234),
                        new XAttribute("att12", "abcde"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att12=\'abcde\'\n' +
                    '        att45=\'1234\'\n' +
                    '        att99=\'1234\'\n' +
                    '        qwer=\'ty\'\n' +
                    '        xmlns:e=\'http://www.ericwhite.com\'/>'
            },
            {
                testNum: 25,
                testFunc: function () {
                    var txt, xmlDoc3;

                    txt = "<bookstore xmlns='http://www.ericwhite.com'><book>";
                    txt = txt + "<title>Everyday Italian</title>";
                    txt = txt + "<author>Giada De Laurentiis</author>";
                    txt = txt + "<year>2005</year>";
                    txt = txt + "</book></bookstore>";

                    xmlDoc3 = parseXml(txt);
                    var e = XElement.load(xmlDoc3.documentElement);
                    var o = '';
                    o += e.toString(true);
                    o += checkParentage(e);
                    return o;
                },
                output:
                    '<bookstore xmlns=\'http://www.ericwhite.com\'>\n' +
                    '  <book>\n' +
                    '    <title>Everyday Italian</title>\n' +
                    '    <author>Giada De Laurentiis</author>\n' +
                    '    <year>2005</year>\n' +
                    '  </book>\n' +
                    '</bookstore>'
            },
            {
                testNum: 26,
                testFunc: function () {
                    var e = XNamespace("http://www.ericwhite.com");
                    var xa = [
                        new XElement(e + "boo"),
                        new XElement(e + "yar"),
                        new XElement(e + "baz")
                    ];
                    var exa = Enumerable.from(xa);
                    var e = new XElement(e + 'root',
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        exa);
                    var o = '';
                    o += e.toString(true);
                    o += checkParentage(e);
                    return o;
                },
                output:
                    '<e:root xmlns:e=\'http://www.ericwhite.com\'>\n' +
                    '  <e:boo/>\n' +
                    '  <e:yar/>\n' +
                    '  <e:baz/>\n' +
                    '</e:root>'
            },
            {
                testNum: 27,
                testFunc: function () {
                    var txt, xmlDoc3;

                    txt = "<bookstore><book>";
                    txt = txt + "<title>Everyday Italian</title>";
                    txt = txt + "<author>Giada De Laurentiis</author>";
                    txt = txt + "<year>2005</year>";
                    txt = txt + "</book></bookstore>";

                    //var parser3;
                    //if (!DOMParser)
                    //    parser3 = new ActiveXObject("MSXML2.DOMDocument");
                    //else
                    //    parser3 = new DOMParser();
                    //xmlDoc3 = parser3.parseFromString(txt, "text/xml");
                    xmlDoc3 = parseXml(txt);
                    var e = XElement.load(xmlDoc3.documentElement);
                    var o = '';
                    o += e.toString(true);
                    o += checkParentage(e);
                    return o;
                },
                output:
                    '<bookstore>\n' +
                    '  <book>\n' +
                    '    <title>Everyday Italian</title>\n' +
                    '    <author>Giada De Laurentiis</author>\n' +
                    '    <year>2005</year>\n' +
                    '  </book>\n' +
                    '</bookstore>'
            },
            {
                testNum: 28,
                testFunc: function () {
                    var txt, xmlDoc3;

                    txt = "<bookstore app='1'><book>";
                    txt = txt + "<title>Everyday Italian</title>";
                    txt = txt + "<author>Giada De Laurentiis</author>";
                    txt = txt + "<year>2005</year>";
                    txt = txt + "</book></bookstore>";

                    //var parser3;
                    //if (!DOMParser)
                    //    parser3 = new ActiveXObject("MSXML2.DOMDocument");
                    //else
                    //    parser3 = new DOMParser();
                    //xmlDoc3 = parser3.parseFromString(txt, "text/xml");
                    xmlDoc3 = parseXml(txt);
                    var e = XElement.load(xmlDoc3.documentElement);
                    var o = '';
                    o += e.toString(true);
                    o += checkParentage(e);
                    return o;
                },
                output:
                    '<bookstore app=\'1\'>\n' +
                    '  <book>\n' +
                    '    <title>Everyday Italian</title>\n' +
                    '    <author>Giada De Laurentiis</author>\n' +
                    '    <year>2005</year>\n' +
                    '  </book>\n' +
                    '</bookstore>'
            },
            {
                testNum: 29,
                testFunc: function () {
                    // ================================ content:no indent:yes attributes:*
                    var e = XNamespace("http://www.ericwhite.com");
                    var aw = XNamespace("http://www.adventureworks.com");
                    var x = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XAttribute(XNamespace.getXmlns() + "aw", aw.namespaceName),
                        new XAttribute(aw + "att45", 1234),
                        new XAttribute("att12", "abcde"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root att12=\'abcde\'\n' +
                    '        aw:att45=\'1234\'\n' +
                    '        xmlns:aw=\'http://www.adventureworks.com\'\n' +
                    '        xmlns:e=\'http://www.ericwhite.com\'/>'
            },
            {
                testNum: 30,
                testFunc: function () {
                    var x = new XElement("root",
                        new XElement("child"),
                        new XComment("this is a comment"),
                        new XElement("child"));
                    var o = '';
                    o += x.toString(true);
                    o += x.toString() + '\n';
                    var c = x.descendantNodes().where(function (n) { return n.nodeType === 'Comment'; }).firstOrDefault();
                    o += c.value + '\n';
                    c.value = 'Hello world';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <child/>\n' +
                    '  <!--this is a comment-->\n' +
                    '  <child/>\n' +
                    '</root>\n' +
                    '<root><child/><!--this is a comment--><child/></root>\n' +
                    'this is a comment\n' +
                    '<root>\n' +
                    '  <child/>\n' +
                    '  <!--Hello world-->\n' +
                    '  <child/>\n' +
                    '</root>'
            },
            {
                testNum: 31,
                testFunc: function () {
                    var x = new XElement("root",
                        new XElement("child"),
                        new XCData("this is CDATA\nthis is on a second line\na third line is here"),
                        new XElement("child"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <child/>\n' +
                    '  <![CDATA[this is CDATA\n' +
                    'this is on a second line\n' +
                    'a third line is here]]>\n' +
                    '  <child/>\n' +
                    '</root>'
            },
            {
                testNum: 32,
                testFunc: function () {
                    var x = new XElement("root",
                        new XElement("child", "123"));
                    // call copy constructor
                    var y = new XElement(x);
                    var o = '';
                    o += y.toString(true);
                    o += checkParentage(y);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <child>123</child>\n' +
                    '</root>'
            },
            {
                testNum: 33,
                testFunc: function () {
                    var x = new XElement("root",
                        new XAttribute("boo", "yar"),
                        new XElement("child", "123"),
                        new XComment("hello"),
                        new XElement("test",
                            new XText("hello world")),
                        new XCData("this is cdata"));
                    // call copy constructor
                    var y = new XElement(x);
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    o += "=================================\n";
                    o += y.toString(true);
                    o += checkParentage(y);
                    o += "=================================\n";
                    o += (x === y).toString() + '\n';
                    var a1 = x.attribute("boo");
                    var a2 = y.attribute("boo");
                    o += a1.toString() + '\n';
                    o += a2.toString() + '\n';
                    o += (a1 === a2).toString() + '\n';
                    var e1 = x.element("child");
                    var e2 = y.element("child");
                    o += e1.toString() + '\n';
                    o += e2.toString() + '\n';
                    o += (e1 === e2).toString() + '\n';
                    return o;
                },
                output:
                    '<root boo=\'yar\'>\n' +
                    '  <child>123</child>\n' +
                    '  <!--hello-->\n' +
                    '  <test>hello world</test>\n' +
                    '  <![CDATA[this is cdata]]>\n' +
                    '</root>\n' +
                    '=================================\n' +
                    '<root boo=\'yar\'>\n' +
                    '  <child>123</child>\n' +
                    '  <!--hello-->\n' +
                    '  <test>hello world</test>\n' +
                    '  <![CDATA[this is cdata]]>\n' +
                    '</root>\n' +
                    '=================================\n' +
                    'false\n' +
                    'boo=\'yar\'\n' +
                    'boo=\'yar\'\n' +
                    'false\n' +
                    '<child>123</child>\n' +
                    '<child>123</child>\n' +
                    'false'
            },
            {
                testNum: 34,
                testFunc: function () {
                    var x = new XElement("root");
                    var y = new XElement(x);
                    var o = '';
                    o += x.toString(true);
                    o += y.toString(true);
                    o += (x === y).toString() + '\n';
                    return o;
                },
                output:
                    '<root/>\n' +
                    '<root/>\n' +
                    'false'
            },
            {
                testNum: 35,
                testFunc: function () {
                    var x = new XAttribute("att", 123);
                    var y = new XAttribute(x);
                    var o = '';
                    o += x.toString(true) + '\n';
                    o += y.toString(true) + '\n';
                    o += (x === y).toString() + '\n';
                    return o;
                },
                output:
                    'att=\'123\'\n' +
                    'att=\'123\'\n' +
                    'false'
            },
            {
                testNum: 36,
                testFunc: function () {
                    var x = new XText("boo");
                    var y = new XText(x);
                    var o = '';
                    o += x.toString(true) + '\n';
                    o += y.toString(true) + '\n';
                    o += (x === y).toString() + '\n';
                    return o;
                },
                output:
                    'boo\n' +
                    'boo\n' +
                    'false'
            },
            {
                testNum: 37,
                testFunc: function () {
                    var x = new XComment("boo");
                    var y = new XComment(x);
                    var o = '';
                    o += x.toString(true);
                    o += y.toString(true);
                    o += (x === y).toString() + '\n';
                    return o;
                },
                output:
                    '<!--boo-->\n' +
                    '<!--boo-->\n' +
                    'false'
            },
            {
                testNum: 38,
                testFunc: function () {
                    var x = new XCData("boo");
                    var y = new XCData(x);
                    var o = '';
                    o += x.toString(true);
                    o += y.toString(true);
                    o += (x === y).toString() + '\n';
                    return o;
                },
                output:
                    '<![CDATA[boo]]>\n' +
                    '<![CDATA[boo]]>\n' +
                    'false'
            },
            {
                testNum: 39,
                testFunc: function () {
                    var z1 = XName.get("{http://www.ericwhite.com/}root");
                    var o = '';
                    o += z1.toString() + '\n';
                    o += z1.localName + '\n';
                    o += z1.namespaceName + '\n';
                    o += z1.namespace.namespaceName + '\n';
                    var z2 = XName.get("http://www.ericwhite.com/", "boo");
                    o += z2.toString() + '\n';
                    o += z2.localName + '\n';
                    o += z2.namespaceName + '\n';
                    o += z2.namespace.namespaceName + '\n';
                    return o;
                },
                output:
                    '{http://www.ericwhite.com/}root\n' +
                    'root\n' +
                    'http://www.ericwhite.com/\n' +
                    'http://www.ericwhite.com/\n' +
                    '{http://www.ericwhite.com/}boo\n' +
                    'boo\n' +
                    'http://www.ericwhite.com/\n' +
                    'http://www.ericwhite.com/'
            },
            {
                testNum: 40,
                testFunc: function () {
                    var ns40 = XNamespace.get("http://www.ericwhite.com/");
                    var o = '';
                    o += ns40.namespaceName + '\n';

                    var ns40 = new XNamespace("http://www.adventureworks.com/");
                    o += ns40.namespaceName + '\n';

                    var nm40 = ns40.getName("baz");
                    o += nm40.toString() + '\n';

                    o += XNamespace.getXml() + '\n';
                    o += XNamespace.getXmlns() + '\n';
                    return o;
                },
                output:
                    'http://www.ericwhite.com/\n' +
                    'http://www.adventureworks.com/\n' +
                    '{http://www.adventureworks.com/}baz\n' +
                    '{http://www.w3.org/XML/1998/namespace}\n' +
                    '{http://www.w3.org/2000/xmlns/}'
            },
            {
                testNum: 41,
                testFunc: function () {
                    var o;
                    var o41 = new XElement("hello");
                    o41.addAnnotation('text', 'hello world');
                    o41.addAnnotation('text', 'goodbye');
                    o41.addAnnotation('number', 123);
                    o = '';
                    o += 'length of annotations: ' + o41.annotations().count() + '\n';
                    o += 'look for text annotations: ' + o41.annotations('text').count() + '\n';
                    o += 'look for annotations that are not there: ' + o41.annotations('notThere').count() + '\n';
                    o += 'first: ' + o41.annotation('text').toString() + '\n';
                    o41.removeAnnotations('number');
                    o += 'length of annotations after "number": ' + o41.annotations().count() + '\n';
                    o41.removeAnnotations('text');
                    o += 'length of annotations after removing "text": ' + o41.annotations().count() + '\n';
                    o41.addAnnotation('text', 'hello world');
                    o41.addAnnotation('text', 'goodbye');
                    o41.addAnnotation('number', 123);
                    o += 'length of annotations after re-adding: ' + o41.annotations().count() + '\n';
                    o41.removeAnnotations();
                    o += 'length of annotations after removing all: ' + o41.annotations().count() + '\n';
                    return o;
                },
                output:
                    'length of annotations: 3\n' +
                    'look for text annotations: 2\n' +
                    'look for annotations that are not there: 0\n' +
                    'first: hello world\n' +
                    'length of annotations after "number": 2\n' +
                    'length of annotations after removing "text": 0\n' +
                    'length of annotations after re-adding: 3\n' +
                    'length of annotations after removing all: 0'
            },
            {
                testNum: 42,
                testFunc: function () {
                    var e = new XElement("root",
                        new XElement("child1", 111),
                        new XElement("child2", 222),
                        new XElement("child3", 333));
                    var o = '';
                    o += e.toString(true);
                    var e2 = e.element("child2");
                    var e3 = new XElement("child999", 999);
                    e2.addAfterSelf(e3);
                    o += "================================\n";
                    o += e.toString(true);
                    o += checkParentage(e);
                    o += checkParentage(e2);
                    o += checkParentage(e3);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <child1>111</child1>\n' +
                    '  <child2>222</child2>\n' +
                    '  <child3>333</child3>\n' +
                    '</root>\n' +
                    '================================\n' +
                    '<root>\n' +
                    '  <child1>111</child1>\n' +
                    '  <child2>222</child2>\n' +
                    '  <child999>999</child999>\n' +
                    '  <child3>333</child3>\n' +
                    '</root>'
            },
            {
                testNum: 43,
                testFunc: function () {
                    var e = new XElement("root",
                        new XElement("child1", 111),
                        new XElement("child2", 222),
                        new XElement("child3", 333));
                    var o = '';
                    o += e.toString(true);
                    var e2 = e.element("child1");
                    var e3 = new XElement("child999", 999);
                    e2.addAfterSelf(e3);
                    o += "================================\n";
                    o += e.toString(true);
                    o += checkParentage(e);
                    o += checkParentage(e2);
                    o += checkParentage(e3);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <child1>111</child1>\n' +
                    '  <child2>222</child2>\n' +
                    '  <child3>333</child3>\n' +
                    '</root>\n' +
                    '================================\n' +
                    '<root>\n' +
                    '  <child1>111</child1>\n' +
                    '  <child999>999</child999>\n' +
                    '  <child2>222</child2>\n' +
                    '  <child3>333</child3>\n' +
                    '</root>'
            },
            {
                testNum: 44,
                testFunc: function () {
                    var e = new XElement("root",
                        new XElement("child1", 111),
                        new XElement("child2", 222),
                        new XElement("child3", 333));
                    var o = '';
                    o += e.toString(true);
                    var e2 = e.element("child3");
                    var e3 = new XElement("child999", 999);
                    e2.addAfterSelf(e3);
                    o += "================================\n";
                    o += e.toString(true);
                    o += checkParentage(e);
                    o += checkParentage(e2);
                    o += checkParentage(e3);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <child1>111</child1>\n' +
                    '  <child2>222</child2>\n' +
                    '  <child3>333</child3>\n' +
                    '</root>\n' +
                    '================================\n' +
                    '<root>\n' +
                    '  <child1>111</child1>\n' +
                    '  <child2>222</child2>\n' +
                    '  <child3>333</child3>\n' +
                    '  <child999>999</child999>\n' +
                    '</root>'
            },
            {
                testNum: 45,
                testFunc: function () {
                    var e = new XElement("root",
                        new XElement("child1", 111),
                        new XElement("child2", 222),
                        new XElement("child3", 333));
                    var o = '';
                    o += e.toString(true);
                    var e2 = e.element("child1");
                    var e3 = new XElement("child999", 999);
                    e2.addBeforeSelf(e3);
                    o += "================================\n";
                    o += e.toString(true);
                    o += checkParentage(e);
                    o += checkParentage(e2);
                    o += checkParentage(e3);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <child1>111</child1>\n' +
                    '  <child2>222</child2>\n' +
                    '  <child3>333</child3>\n' +
                    '</root>\n' +
                    '================================\n' +
                    '<root>\n' +
                    '  <child999>999</child999>\n' +
                    '  <child1>111</child1>\n' +
                    '  <child2>222</child2>\n' +
                    '  <child3>333</child3>\n' +
                    '</root>'
            },
            {
                testNum: 46,
                testFunc: function () {
                    var e = new XElement("root",
                        new XElement("child1", 111),
                        new XElement("child2", 222),
                        new XElement("child3", 333));
                    var o = '';
                    o += e.toString(true);
                    var e2 = e.element("child3");
                    var e3 = new XElement("child999", 999);
                    e2.addBeforeSelf(e3);
                    o += "================================\n";
                    o += e.toString(true);
                    o += checkParentage(e);
                    o += checkParentage(e2);
                    o += checkParentage(e3);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <child1>111</child1>\n' +
                    '  <child2>222</child2>\n' +
                    '  <child3>333</child3>\n' +
                    '</root>\n' +
                    '================================\n' +
                    '<root>\n' +
                    '  <child1>111</child1>\n' +
                    '  <child2>222</child2>\n' +
                    '  <child999>999</child999>\n' +
                    '  <child3>333</child3>\n' +
                    '</root>'
            },
            {
                testNum: 47,
                testFunc: function () {
                    var xmlTree = new XElement("Root",
                        new XElement("Child",
                            new XElement("GrandChild", "content")
                        )
                    );
                    var grandChild = xmlTree.descendants("GrandChild").first();
                    var o = '';
                    grandChild.ancestors().forEach(function (e) { o += e.name + '\n'; });
                    o += '=====\n';
                    grandChild.ancestors("Root").forEach(function (e) { o += e.name + '\n'; });
                    o += '=====\n';
                    grandChild.ancestorsAndSelf().forEach(function (e) { o += e.name + '\n'; });
                    o += '=====\n';
                    grandChild.ancestorsAndSelf("GrandChild").forEach(function (e) { o += e.name + '\n'; });
                    o += checkParentage(xmlTree);
                    return o;
                },
                output:
                    'Child\n' +
                    'Root\n' +
                    '=====\n' +
                    'Root\n' +
                    '=====\n' +
                    'GrandChild\n' +
                    'Child\n' +
                    'Root\n' +
                    '=====\n' +
                    'GrandChild'
            },
            {
                testNum: 48,
                testFunc: function () {
                    var a1 = new XElement("Root");
                    var a2 = new XElement("Root");
                    var o = '';
                    o += a1.deepEquals(a2).toString() + '\n';                  // true
                    o += checkParentage(a1);
                    o += checkParentage(a2);

                    var b1 = new XElement("Root",
                    new XAttribute("att1", 123));
                    var b2 = new XElement("Root",
                    new XAttribute("att1", 123));
                    o += b1.deepEquals(b2).toString() + '\n';                  // true
                    o += checkParentage(b1);
                    o += checkParentage(b2);

                    var c1 = new XElement("Root",
                    new XAttribute("att1", 123),
                    new XAttribute("att2", 456));
                    var c2 = new XElement("Root",
                    new XAttribute("att2", 456),
                    new XAttribute("att1", 123));
                    o += c1.deepEquals(c2).toString() + '\n';                  // true
                    o += checkParentage(c1);
                    o += checkParentage(c2);

                    var e1 = new XElement("root",
                    new XElement("child1", 111),
                    new XElement("child2", 222),
                    new XElement("child3", 333));
                    var e2 = new XElement("root",
                    new XElement("child1", 111),
                    new XElement("child2", 222),
                    new XElement("child3", 333));
                    o += e1.deepEquals(e2).toString() + '\n';                  // true
                    o += checkParentage(e1);
                    o += checkParentage(e2);

                    var e1 = new XElement("root",
                    new XElement("child1", 111),
                    new XElement("hello"),
                    new XElement("child2", 222),
                    new XElement("child3", 333));
                    var e2 = new XElement("root",
                    new XElement("child1", 111),
                    new XElement("hello"),
                    new XElement("child2", 222),
                    new XElement("child3", 333));
                    o += e1.deepEquals(e2).toString() + '\n';                  // true
                    o += checkParentage(e1);
                    o += checkParentage(e2);

                    var e1 = new XElement("root",
                    new XElement("child1", 111),
                    new XElement("child2", 222),
                    new XElement("child3", 333));
                    var e2 = new XElement("root",
                    new XElement("child2", 222),
                    new XElement("child1", 111),
                    new XElement("child3", 333));
                    o += e1.deepEquals(e2).toString() + '\n';                  // false
                    o += checkParentage(e1);
                    o += checkParentage(e2);

                    var e1 = new XElement("root",
                    new XElement("child1", 111),
                    new XElement("hello"),
                    new XElement("child2", 222),
                    new XElement("child3", 333));
                    var e2 = new XElement("root",
                    new XElement("child1", 111),
                    new XElement("hello2"),
                    new XElement("child2", 222),
                    new XElement("child3", 333));
                    o += e1.deepEquals(e2).toString() + '\n';                  // false
                    o += checkParentage(e1);
                    o += checkParentage(e2);

                    var e1 = new XElement("root",
                    new XElement("child1", 111),
                    new XElement("hello"),
                    new XElement("child2", 222),
                    new XElement("child3", 333));
                    var e2 = new XElement("root",
                    new XElement("child1", 111),
                    new XElement("hello"),
                    new XElement("child3", 333));
                    o += e1.deepEquals(e2).toString() + '\n';                  // false
                    o += checkParentage(e1);
                    o += checkParentage(e2);

                    var c1 = new XElement("Root",
                        new XAttribute("att1", 123),
                        new XAttribute("att2", 456));
                    var c2 = new XElement("Root",
                        new XAttribute("att1", 123));
                    o += c1.deepEquals(c2).toString() + '\n';                  // false
                    o += checkParentage(c1);
                    o += checkParentage(c2);

                    return o;
                },
                output:
                    'true\n' +
                    'true\n' +
                    'true\n' +
                    'true\n' +
                    'true\n' +
                    'false\n' +
                    'false\n' +
                    'false\n' +
                    'false'
            },
            {
                testNum: 49,
                testFunc: function () {
                    var root = new XElement("root",
                        new XElement("c1", 1),
                        new XElement("c2", 1),
                        new XElement("c3", 1),
                        new XElement("c4", 1),
                        new XElement("c5", 1),
                        new XElement("c6", 1),
                        new XElement("c7", 1),
                        new XElement("c8", 1)
                    );
                    var o = '';
                    o += root.toString(true);
                    o += "==========================\n";
                    var c4 = root.element("c4");
                    var root2 = new XElement("root2",
                        c4.elementsAfterSelf());
                    o += root2.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <c1>1</c1>\n' +
                    '  <c2>1</c2>\n' +
                    '  <c3>1</c3>\n' +
                    '  <c4>1</c4>\n' +
                    '  <c5>1</c5>\n' +
                    '  <c6>1</c6>\n' +
                    '  <c7>1</c7>\n' +
                    '  <c8>1</c8>\n' +
                    '</root>\n' +
                    '==========================\n' +
                    '<root2>\n' +
                    '  <c5>1</c5>\n' +
                    '  <c6>1</c6>\n' +
                    '  <c7>1</c7>\n' +
                    '  <c8>1</c8>\n' +
                    '</root2>'
            },
            {
                testNum: 50,
                testFunc: function () {
                    var root = new XElement("root",
                        new XElement("c1", 1),
                        new XElement("c2", 1),
                        new XElement("c3", 1),
                        new XElement("c4", 1),
                        new XElement("c5", 1),
                        new XElement("c6", 1),
                        new XElement("c6", 2),
                        new XElement("c6", 3),
                        new XElement("c7", 1),
                        new XElement("c8", 1)
                    );
                    var o = '';
                    o += root.toString(true);
                    o += "==========================\n";
                    var c4 = root.element("c4");
                    var root2 = new XElement("root2",
                        c4.elementsAfterSelf('c6'));
                    o += root2.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <c1>1</c1>\n' +
                    '  <c2>1</c2>\n' +
                    '  <c3>1</c3>\n' +
                    '  <c4>1</c4>\n' +
                    '  <c5>1</c5>\n' +
                    '  <c6>1</c6>\n' +
                    '  <c6>2</c6>\n' +
                    '  <c6>3</c6>\n' +
                    '  <c7>1</c7>\n' +
                    '  <c8>1</c8>\n' +
                    '</root>\n' +
                    '==========================\n' +
                    '<root2>\n' +
                    '  <c6>1</c6>\n' +
                    '  <c6>2</c6>\n' +
                    '  <c6>3</c6>\n' +
                    '</root2>'
            },
            {
                testNum: 51,
                testFunc: function () {
                    var root = new XElement("root",
                        new XElement("c1", 1),
                        new XElement("c2", 1),
                        new XElement("c3", 1),
                        new XElement("c4", 1),
                        new XElement("c5", 1),
                        new XElement("c6", 1),
                        new XElement("c7", 1),
                        new XElement("c8", 1)
                    );
                    var o = '';
                    o += root.toString(true);
                    o += "==========================\n";
                    var c4 = root.element("c4");
                    var root2 = new XElement("root2",
                        c4.elementsBeforeSelf());
                    o += root2.toString(true);
                    o += checkParentage(root);
                    o += checkParentage(root2);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <c1>1</c1>\n' +
                    '  <c2>1</c2>\n' +
                    '  <c3>1</c3>\n' +
                    '  <c4>1</c4>\n' +
                    '  <c5>1</c5>\n' +
                    '  <c6>1</c6>\n' +
                    '  <c7>1</c7>\n' +
                    '  <c8>1</c8>\n' +
                    '</root>\n' +
                    '==========================\n' +
                    '<root2>\n' +
                    '  <c1>1</c1>\n' +
                    '  <c2>1</c2>\n' +
                    '  <c3>1</c3>\n' +
                    '</root2>'
            },
            {
                testNum: 52,
                testFunc: function () {
                    var root = new XElement("root",
                        new XElement("c1", 1),
                        new XElement("c2", 1),
                        new XElement("c2", 2),
                        new XElement("c2", 3),
                        new XElement("c3", 1),
                        new XElement("c4", 1),
                        new XElement("c5", 1),
                        new XElement("c6", 1),
                        new XElement("c7", 1),
                        new XElement("c8", 1)
                    );
                    var o = '';
                    o += root.toString(true);
                    o += "==========================\n";
                    var c4 = root.element("c4");
                    var root2 = new XElement("root2",
                        c4.elementsBeforeSelf("c2"));
                    o += root2.toString(true);
                    o += checkParentage(root);
                    o += checkParentage(root2);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <c1>1</c1>\n' +
                    '  <c2>1</c2>\n' +
                    '  <c2>2</c2>\n' +
                    '  <c2>3</c2>\n' +
                    '  <c3>1</c3>\n' +
                    '  <c4>1</c4>\n' +
                    '  <c5>1</c5>\n' +
                    '  <c6>1</c6>\n' +
                    '  <c7>1</c7>\n' +
                    '  <c8>1</c8>\n' +
                    '</root>\n' +
                    '==========================\n' +
                    '<root2>\n' +
                    '  <c2>1</c2>\n' +
                    '  <c2>2</c2>\n' +
                    '  <c2>3</c2>\n' +
                    '</root2>'
            },
            {
                testNum: 53,
                testFunc: function () {
                    var root = new XElement("root",
                        new XElement("C1",
                            new XElement("GC1", 111),
                            new XElement("GC2", 111),
                            new XElement("GC3", 111)
                        ),
                        new XElement("C2",
                            new XElement("GC4", 111),
                            new XElement("GC5",
                                new XElement("GGC1"),
                                new XElement("GGC2")
                            ),
                            new XElement("GC6", 111)
                        ),
                        new XElement("C3",
                            new XElement("GC7", 111),
                            new XElement("GC8", 111),
                            new XElement("GC9", 111)
                        )
                    );
                    var o = '';
                    var c1 = root.element("C2");
                    var r1 = c1.descendants().toArray();
                    o += root.toString(true);
                    o += "=============================\n";
                    for (var i = 0; i < r1.length; i++) {
                        o += r1[i].name + '\n';
                    }
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <C1>\n' +
                    '    <GC1>111</GC1>\n' +
                    '    <GC2>111</GC2>\n' +
                    '    <GC3>111</GC3>\n' +
                    '  </C1>\n' +
                    '  <C2>\n' +
                    '    <GC4>111</GC4>\n' +
                    '    <GC5>\n' +
                    '      <GGC1/>\n' +
                    '      <GGC2/>\n' +
                    '    </GC5>\n' +
                    '    <GC6>111</GC6>\n' +
                    '  </C2>\n' +
                    '  <C3>\n' +
                    '    <GC7>111</GC7>\n' +
                    '    <GC8>111</GC8>\n' +
                    '    <GC9>111</GC9>\n' +
                    '  </C3>\n' +
                    '</root>\n' +
                    '=============================\n' +
                    'GC4\n' +
                    'GC5\n' +
                    'GGC1\n' +
                    'GGC2\n' +
                    'GC6'
            },
            {
                testNum: 54,
                testFunc: function () {
                    var root = new XElement("root",
                        new XElement("C1",
                            new XElement("GC1", 111),
                            new XElement("GC2", 111),
                            new XElement("GC3", 111)
                        ),
                        new XElement("C2",
                            new XElement("GC4", 111),
                            new XElement("GC5",
                                new XElement("GGC1"),
                                new XElement("GGC2")
                            ),
                            new XElement("GC6", 111)
                        ),
                        new XElement("C3",
                            new XElement("GC7", 111),
                            new XElement("GC8", 111),
                            new XElement("GC9", 111)
                        )
                    );
                    var o = '';
                    var r1 = root.descendants().toArray();
                    for (var i = 0; i < r1.length; i++) {
                        o += r1[i].name + '\n';
                    }
                    o += checkParentage(root);
                    return o;
                },
                output:
                    'C1\n' +
                    'GC1\n' +
                    'GC2\n' +
                    'GC3\n' +
                    'C2\n' +
                    'GC4\n' +
                    'GC5\n' +
                    'GGC1\n' +
                    'GGC2\n' +
                    'GC6\n' +
                    'C3\n' +
                    'GC7\n' +
                    'GC8\n' +
                    'GC9'
            },
            {
                testNum: 55,
                testFunc: function () {
                    var xmlTree = new XElement("Root",
                        new XElement("Child",
                            new XElement("GrandChild", "content")
                        )
                    );
                    var grandChild = xmlTree.descendants("GrandChild").first();
                    var o = '';
                    o += xmlTree.toString(true);
                    o += "==========================\n";
                    var a = grandChild.ancestors("Child").toArray();
                    for (var i = 0; i < a.length; i++) {
                        o += a[i].name + '\n';
                    }
                    o += checkParentage(xmlTree);
                    return o;
                },
                output:
                    '<Root>\n' +
                    '  <Child>\n' +
                    '    <GrandChild>content</GrandChild>\n' +
                    '  </Child>\n' +
                    '</Root>\n' +
                    '==========================\n' +
                    'Child'
            },
            {
                testNum: 56,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XElement("C1", 111),
                        new XElement("C2", 222),
                        new XText("hello"),
                        new XComment("this is comment"),
                        new XElement("C3", 111),
                        new XElement("C4", 222));
                    var c3 = root.element("C3");
                    var nbs = c3.nodesBeforeSelf().toArray();
                    var o = '';
                    for (var i = 0; i < nbs.length; i++) {
                        o += nbs[i].nodeType + '\n';
                    }
                    o += "====================\n";
                    var c2 = root.element("C2");
                    var nas = c2.nodesAfterSelf().toArray();
                    for (var i = 0; i < nbs.length; i++) {
                        o += nas[i].nodeType + '\n';
                    }
                    o += "====================\n";
                    var nn = c2.getNextNode();
                    o += nn.nodeType + '\n';
                    var pn = c2.getPreviousNode();
                    o += pn.nodeType + '\n';
                    var c1 = root.element("C1");
                    pn = c1.getPreviousNode();
                    o += (pn === null).toString() + '\n';
                    var c4 = root.element("C4");
                    nn = c4.getNextNode();
                    o += (nn === null).toString() + '\n';
                    o += checkParentage(root);
                    return o;
                },
                output:
                    'Element\n' +
                    'Element\n' +
                    'Text\n' +
                    'Comment\n' +
                    '====================\n' +
                    'Text\n' +
                    'Comment\n' +
                    'Element\n' +
                    'Element\n' +
                    '====================\n' +
                    'Text\n' +
                    'Element\n' +
                    'true\n' +
                    'true'
            },
            {
                testNum: 57,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XElement("C1", 111),
                        new XElement("C2", 222),
                        new XText("hello"),
                        new XComment("this is comment"),
                        new XElement("C3", 111),
                        new XElement("C4", 222));
                    var c3 = root.element("C3");
                    c3.remove();
                    var o = '';
                    o += root.toString(true);
                    o += "====================\n";
                    var c1 = root.element("C1");
                    c1.remove();
                    o += root.toString(true);
                    o += "====================\n";
                    var c4 = root.element("C4");
                    c4.remove();
                    o += root.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<Root><C1>111</C1><C2>222</C2>hello<!--this is comment--><C4>222</C4></Root>\n' +
                    '====================\n' +
                    '<Root><C2>222</C2>hello<!--this is comment--><C4>222</C4></Root>\n' +
                    '====================\n' +
                    '<Root><C2>222</C2>hello<!--this is comment--></Root>'
            },
            {
                testNum: 58,
                testFunc: function () {
                    var o;

                    var root = new XElement("Root",
                        new XElement("C1", 111),
                        new XElement("C2", 222),
                        new XElement("C3", 333),
                        new XElement("C4", 444));
                    var c2 = root.element("C2");
                    c2.replaceWith(
                        new XElement("R1", 1),
                        new XElement("R2", 2),
                        new XElement("R3", 3));
                    o += checkParentage(root);
                    o = '';
                    o += root.toString(true);
                    o += "====================\n";
                    var c1name = new XName("C1");
                    var c1 = root.element(c1name);
                    c1.replaceWith(
                        new XElement("First", 1),
                        new XElement("Second", 2));
                    o += root.toString(true);
                    o += checkParentage(root);
                    o += "====================\n";
                    var c4 = root.element("C4");
                    c4.replaceWith(
                        new XComment("C4 is replaced with a comment"));
                    o += root.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<Root>\n' +
                    '  <C1>111</C1>\n' +
                    '  <R1>1</R1>\n' +
                    '  <R2>2</R2>\n' +
                    '  <R3>3</R3>\n' +
                    '  <C3>333</C3>\n' +
                    '  <C4>444</C4>\n' +
                    '</Root>\n' +
                    '====================\n' +
                    '<Root>\n' +
                    '  <First>1</First>\n' +
                    '  <Second>2</Second>\n' +
                    '  <R1>1</R1>\n' +
                    '  <R2>2</R2>\n' +
                    '  <R3>3</R3>\n' +
                    '  <C3>333</C3>\n' +
                    '  <C4>444</C4>\n' +
                    '</Root>\n' +
                    '====================\n' +
                    '<Root>\n' +
                    '  <First>1</First>\n' +
                    '  <Second>2</Second>\n' +
                    '  <R1>1</R1>\n' +
                    '  <R2>2</R2>\n' +
                    '  <R3>3</R3>\n' +
                    '  <C3>333</C3>\n' +
                    '  <!--C4 is replaced with a comment-->\n' +
                    '</Root>'
            },
            {
                testNum: 59,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XAttribute("a1", 1),
                        new XAttribute("a2", 2),
                        new XAttribute("a3", 3),
                        new XAttribute("a4", 4),
                        new XAttribute("a5", 5));
                    var a = root.attribute("a3");
                    var o = '';
                    o += checkParentage(root);
                    a.remove();
                    o += checkParentage(root);
                    o += root.toString(true);
                    o += "====================\n";
                    a = root.attribute("a1");
                    a.remove();
                    o += checkParentage(root);
                    o += root.toString(true);
                    o += "====================\n";
                    a = root.attribute("a5");
                    a.remove();
                    o += checkParentage(root);
                    o += root.toString(true);
                    return o;
                },
                output:
                    '<Root a1=\'1\'\n' +
                    '      a2=\'2\'\n' +
                    '      a4=\'4\'\n' +
                    '      a5=\'5\'/>\n' +
                    '====================\n' +
                    '<Root a2=\'2\'\n' +
                    '      a4=\'4\'\n' +
                    '      a5=\'5\'/>\n' +
                    '====================\n' +
                    '<Root a2=\'2\'\n' +
                    '      a4=\'4\'/>'
            },
            {
                testNum: 60,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XAttribute("Att1", 1),
                        new XAttribute("Att2", 2),
                        new XAttribute("Att3", 3),
                        new XAttribute("Att4", 4),
                        new XAttribute("Att5", 5),
                        new XAttribute("Att6", 6)
                    );
                    var att = root.attribute("Att3");
                    att.value = "new content";
                    var o = '';
                    o += checkParentage(root);
                    o += root.toString(true);
                    o += "====================\n";
                    o += att.getNextAttribute().toString() + '\n';
                    o += att.getPreviousAttribute().toString() + '\n';
                    att = root.attribute("Att1");
                    o += (att.getPreviousAttribute() === null).toString() + '\n';
                    att = root.attribute("Att6");
                    o += (att.getNextAttribute() === null).toString() + '\n';
                    return o;
                },
                output:
                    '<Root Att1=\'1\'\n' +
                    '      Att2=\'2\'\n' +
                    '      Att3=\'new content\'\n' +
                    '      Att4=\'4\'\n' +
                    '      Att5=\'5\'\n' +
                    '      Att6=\'6\'/>\n' +
                    '====================\n' +
                    'Att4=\'4\'\n' +
                    'Att2=\'2\'\n' +
                    'true\n' +
                    'true'
            },
            {
                testNum: 61,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XElement("C1", 1),
                        new XElement("C2", 2),
                        new XElement("C3", 3));
                    root.add(
                        new XElement("C4", 4),
                        new XElement("C5", 5),
                        new XAttribute("A1", 1),
                        new XComment("hello"));
                    var o = '';
                    o += root.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<Root A1=\'1\'>\n' +
                    '  <C1>1</C1>\n' +
                    '  <C2>2</C2>\n' +
                    '  <C3>3</C3>\n' +
                    '  <C4>4</C4>\n' +
                    '  <C5>5</C5>\n' +
                    '  <!--hello-->\n' +
                    '</Root>'
            },
            {
                testNum: 62,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XElement("C1", 1),
                        new XElement("C2", 2),
                        new XElement("C3", 3));
                    root.addFirst(
                        new XElement("C4", 4),
                        new XElement("C5", 5),
                        new XAttribute("A1", 1),
                        new XComment("hello"));
                    var o = '';
                    o += root.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<Root A1=\'1\'>\n' +
                    '  <C4>4</C4>\n' +
                    '  <C5>5</C5>\n' +
                    '  <!--hello-->\n' +
                    '  <C1>1</C1>\n' +
                    '  <C2>2</C2>\n' +
                    '  <C3>3</C3>\n' +
                    '</Root>'
            },
            {
                testNum: 63,
                testFunc: function () {
                    var root = new XElement("root",
                        new XElement("C1",
                            new XElement("GC1", 111),
                            new XElement("GC2", 111),
                            new XElement("GC3", 111),
                            new XComment("a comment"),
                            new XElement("WhatItIs",
                                new XText("abc"))
                        ),
                        new XElement("C2",
                            new XElement("GC4", 111),
                            new XElement("GC5",
                                new XElement("GGC1"),
                                new XElement("GGC2")
                            ),
                            new XElement("GC6", 111)
                        ),
                        new XElement("C3",
                            new XElement("GC7", 111),
                            new XElement("GC8", 111),
                            new XElement("GC9", 111)
                        )
                    );
                    var o = '';
                    var r1 = root.descendantNodes().toArray();
                    for (var i = 0; i < r1.length; i++) {
                        if (r1[i].nodeType === 'Element')
                            o += r1[i].name + '\n';
                        else
                            o += r1[i].nodeType + '\n';
                    }
                    o += checkParentage(root);
                    return o;
                },
                output:
                    'C1\n' +
                    'GC1\n' +
                    'Text\n' +
                    'GC2\n' +
                    'Text\n' +
                    'GC3\n' +
                    'Text\n' +
                    'Comment\n' +
                    'WhatItIs\n' +
                    'Text\n' +
                    'C2\n' +
                    'GC4\n' +
                    'Text\n' +
                    'GC5\n' +
                    'GGC1\n' +
                    'GGC2\n' +
                    'GC6\n' +
                    'Text\n' +
                    'C3\n' +
                    'GC7\n' +
                    'Text\n' +
                    'GC8\n' +
                    'Text\n' +
                    'GC9\n' +
                    'Text'
            },
            {
                testNum: 64,
                testFunc: function () {
                    var o;

                    var root = new XElement("Root",
                        new XElement("C1", 111),
                        new XElement("C2", 200),
                        new XElement("C2", 201),
                        new XElement("C2", 202),
                        new XElement("C3", 333),
                        new XElement("C4", 444));
                    var root2 = new XElement("Root2",
                        root.elements());
                    o = '';
                    o += root2.toString(true);
                    o += "====================\n";
                    var root3 = new XElement("Root3",
                        root.elements("C2"));
                    o += root3.toString(true);
                    o += checkParentage(root);
                    o += checkParentage(root2);
                    o += checkParentage(root3);
                    return o;
                },
                output:
                    '<Root2>\n' +
                    '  <C1>111</C1>\n' +
                    '  <C2>200</C2>\n' +
                    '  <C2>201</C2>\n' +
                    '  <C2>202</C2>\n' +
                    '  <C3>333</C3>\n' +
                    '  <C4>444</C4>\n' +
                    '</Root2>\n' +
                    '====================\n' +
                    '<Root3>\n' +
                    '  <C2>200</C2>\n' +
                    '  <C2>201</C2>\n' +
                    '  <C2>202</C2>\n' +
                    '</Root3>'
            },
            {
                testNum: 65,
                testFunc: function () {
                    var o;

                    var root = new XElement("Root",
                        new XElement("C1", 111),
                        new XElement("C2", 200),
                        new XComment("this is going to be deleted"));
                    root.removeNodes();
                    o = '';
                    o += root.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<Root/>'
            },
            {
                testNum: 66,
                testFunc: function () {
                    var o;
                    var root = new XElement("Root",
                        new XElement("C1", 111),
                        new XElement("C2", 200),
                        new XComment("this is going to be deleted"));
                    root.replaceNodes(
                        new XElement("R1", 1),
                        new XElement("R2", 2),
                        new XComment("hello world"),
                        new XElement("R3", 3));
                    o = '';
                    o += root.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<Root>\n' +
                    '  <R1>1</R1>\n' +
                    '  <R2>2</R2>\n' +
                    '  <!--hello world-->\n' +
                    '  <R3>3</R3>\n' +
                    '</Root>'
            },
            {
                testNum: 67,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XElement("C1", 111),
                        new XElement("C2", 200),
                        new XComment("this is going to be deleted"));
                    var o = '';
                    o += root.getFirstNode().toString(true);
                    o += "==============\n";
                    o += root.getLastNode().toString(true);
                    o += "==============\n";
                    root.removeNodes();
                    o += (root.getFirstNode() === null).toString() + '\n';
                    o += (root.getLastNode() === null).toString() + '\n';
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<C1>111</C1>\n' +
                    '==============\n' +
                    '<!--this is going to be deleted-->\n' +
                    '==============\n' +
                    'true\n' +
                    'true'
            },
            {
                testNum: 68,
                testFunc: function () {
                    var xmlTree = new XElement("Root",
                        new XElement("Child",
                            new XElement("GrandChild", "content")
                        )
                    );
                    var grandChild = xmlTree.descendants("GrandChild").first();
                    var o = '';
                    var a = grandChild.ancestorsAndSelf().toArray();
                    for (var i = 0; i < a.length; i++) {
                        o += a[i].name + '\n';
                    }
                    o += "======================\n";
                    var a = grandChild.ancestorsAndSelf("Child").toArray();
                    for (var i = 0; i < a.length; i++) {
                        o += a[i].name + '\n';
                    }
                    o += checkParentage(xmlTree);
                    return o;
                },
                output:
                    'GrandChild\n' +
                    'Child\n' +
                    'Root\n' +
                    '======================\n' +
                    'Child'
            },
            {
                testNum: 69,
                testFunc: function () {
                    var root = new XElement("root",
                        new XElement("C1",
                            new XElement("GC1", 111),
                            new XElement("GC2", 111),
                            new XElement("GC3", 111),
                            new XComment("a comment"),
                            new XElement("WhatItIs",
                                new XText("abc"))
                        ),
                        new XElement("C2",
                            new XElement("GC4", 111),
                            new XElement("GC5",
                                new XElement("GGC1"),
                                new XElement("GGC2")
                            ),
                            new XElement("GC6", 111)
                        ),
                        new XElement("C3",
                            new XElement("GC7", 111),
                            new XElement("GC8", 111),
                            new XElement("GC9", 111)
                        )
                    );
                    var o = '';
                    var r1 = root.descendantNodesAndSelf().toArray();
                    for (var i = 0; i < r1.length; i++) {
                        if (r1[i].nodeType === 'Element')
                            o += r1[i].name + '\n';
                        else
                            o += r1[i].nodeType + '\n';
                    }
                    o += checkParentage(root);
                    return o;
                },
                output:
                    'root\n' +
                    'C1\n' +
                    'GC1\n' +
                    'Text\n' +
                    'GC2\n' +
                    'Text\n' +
                    'GC3\n' +
                    'Text\n' +
                    'Comment\n' +
                    'WhatItIs\n' +
                    'Text\n' +
                    'C2\n' +
                    'GC4\n' +
                    'Text\n' +
                    'GC5\n' +
                    'GGC1\n' +
                    'GGC2\n' +
                    'GC6\n' +
                    'Text\n' +
                    'C3\n' +
                    'GC7\n' +
                    'Text\n' +
                    'GC8\n' +
                    'Text\n' +
                    'GC9\n' +
                    'Text'
            },
            {
                testNum: 70,
                testFunc: function () {
                    var root = new XElement("root",
                        new XElement("C1",
                            new XElement("GC1", 111),
                            new XElement("GC2", 111),
                            new XElement("GC3", 111)
                        ),
                        new XElement("C2",
                            new XElement("GC4", 111),
                            new XElement("GC5",
                                new XElement("GGC1"),
                                new XElement("GGC2")
                            ),
                            new XElement("GC6", 111)
                        ),
                        new XElement("C3",
                            new XElement("GC7", 111),
                            new XElement("GC8", 111),
                            new XElement("GC9", 111)
                        )
                    );
                    var o = '';
                    var r1 = root.descendantsAndSelf().toArray();
                    for (var i = 0; i < r1.length; i++) {
                        o += r1[i].name + '\n';
                    }
                    o += checkParentage(root);
                    return o;
                },
                output:
                    'root\n' +
                    'C1\n' +
                    'GC1\n' +
                    'GC2\n' +
                    'GC3\n' +
                    'C2\n' +
                    'GC4\n' +
                    'GC5\n' +
                    'GGC1\n' +
                    'GGC2\n' +
                    'GC6\n' +
                    'C3\n' +
                    'GC7\n' +
                    'GC8\n' +
                    'GC9'
            },
            {
                testNum: 71,
                testFunc: function () {
                    var root = new XElement("root",
                        new XElement("C1",
                            new XElement("GC1", 111),
                            new XElement("GC2", 111),
                            new XElement("GC3", 111)
                        ),
                        new XElement("C2",
                            new XElement("GC1", 111),
                            new XElement("GC1",
                                new XElement("GGC1"),
                                new XElement("GGC2")
                            ),
                            new XElement("GC6", 111)
                        ),
                        new XElement("GC1",
                            new XElement("GC7", 111),
                            new XElement("GC8", 111),
                            new XElement("GC9", 111)
                        )
                    );
                    var o = '';
                    var r1 = root.descendantsAndSelf('GC1').toArray();
                    var r2 = root.descendantsAndSelf('root').toArray();
                    for (var i = 0; i < r1.length; i++) {
                        o += r1[i].name + '\n';
                    }
                    for (var i = 0; i < r2.length; i++) {
                        o += r2[i].name + '\n';
                    }
                    o += checkParentage(root);
                    return o;
                },
                output:
                    'GC1\n' +
                    'GC1\n' +
                    'GC1\n' +
                    'GC1\n' +
                    'root'
            },
            {
                testNum: 72,
                testFunc: function () {
                    var root = new XElement("root",
                        new XAttribute("a1", 1),
                        new XAttribute("a2", 2),
                        new XAttribute("a3", 3),
                        new XAttribute("a4", 4),
                        new XAttribute("a5", 5));
                    var o = '';
                    o += root.getFirstAttribute().toString() + '\n';
                    o += root.getLastAttribute().toString() + '\n';
                    var root2 = new XElement("root");
                    if (root2.getLastAttribute() === null)
                        o += "lastAttribute on empty att list works\n";
                    o += checkParentage(root);
                    return o;
                },
                output:
                    'a1=\'1\'\n' +
                    'a5=\'5\'\n' +
                    'lastAttribute on empty att list works'
            },
            {
                testNum: 73,
                testFunc: function () {
                    var r1 = new XElement("root",
                        new XAttribute("a1", 1),
                        new XAttribute("a2", 2),
                        new XAttribute("a3", 3),
                        new XAttribute("a4", 4),
                        new XAttribute("a5", 5));
                    var r2 = new XElement("root",
                        new XElement("a1", 1),
                        new XElement("a2", 2),
                        new XElement("a3", 3),
                        new XElement("a4", 4),
                        new XElement("a5", 5));
                    var o = '';
                    o += r1.getHasAttributes().toString() + '\n';
                    o += r1.getHasElements().toString() + '\n';
                    o += r2.getHasAttributes().toString() + '\n';
                    o += r2.getHasElements().toString() + '\n';
                    o += checkParentage(r1);
                    o += checkParentage(r2);
                    return o;
                },
                output:
                    'true\n' +
                    'false\n' +
                    'false\n' +
                    'true'
            },
            {
                testNum: 74,
                testFunc: function () {
                    var o;

                    var el1 = new XElement("Root");
                    o = '';
                    o += el1.toString(true);
                    o += el1.getIsEmpty().toString() + '\n';
                    o += '\n';
                    o += checkParentage(el1);
                    var el2 = new XElement("Root", "content");
                    o += el2.toString(true);
                    o += el2.getIsEmpty().toString() + '\n';
                    o += '\n';
                    o += checkParentage(el2);
                    var el3 = new XElement("Root", "");
                    o += el3.toString(true);
                    o += el3.getIsEmpty().toString() + '\n';
                    o += '\n';
                    o += checkParentage(el3);
                    el3.replaceAll(null);
                    o += el3.toString(true);
                    o += el3.getIsEmpty().toString() + '\n';
                    o += checkParentage(el3);
                    return o;
                },
                output:
                    '<Root/>\n' +
                    'true\n' +
                    '\n' +
                    '<Root>content</Root>\n' +
                    'false\n' +
                    '\n' +
                    '<Root></Root>\n' +
                    'false\n' +
                    '\n' +
                    '<Root/>\n' +
                    'true'
            },
            {
                testNum: 75,
                testFunc: function () {
                    var r = new XElement("Root",
                        new XElement("C1", 1),
                        new XElement("C2", 2),
                        new XElement("C3", 3));
                    var r2 = new XElement("Root2",
                        r.element("C1"),
                        r.element("C5"),
                        r.element("C3"));
                    var o = '';
                    o += r2.toString(true);
                    o += checkParentage(r);
                    o += checkParentage(r2);
                    return o;
                },
                output:
                    '<Root2>\n' +
                    '  <C1>1</C1>\n' +
                    '  <C3>3</C3>\n' +
                    '</Root2>'
            },
            {
                testNum: 76,
                testFunc: function () {
                    var txt;

                    txt = "<bookstore xmlns='http://www.ericwhite.com'><book>";
                    txt = txt + "<title>Everyday Italian</title>";
                    txt = txt + "<author>Giada De Laurentiis</author>";
                    txt = txt + "<year>2005</year>";
                    txt = txt + "</book></bookstore>";
                    var e = XElement.parse(txt);
                    var o = '';
                    o += e.toString(true);
                    o += checkParentage(e);
                    return o;
                },
                output:
                    '<bookstore xmlns=\'http://www.ericwhite.com\'>\n' +
                    '  <book>\n' +
                    '    <title>Everyday Italian</title>\n' +
                    '    <author>Giada De Laurentiis</author>\n' +
                    '    <year>2005</year>\n' +
                    '  </book>\n' +
                    '</bookstore>'
            },
            {
                testNum: 77,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XAttribute("Att1", 1),
                        new XAttribute("Att2", 2),
                        new XAttribute("Att3", 3),
                        new XElement("Child1", 1),
                        new XElement("Child2", 2),
                        new XElement("Child3", 3)
                    );
                    root.removeAll();   // removes children elements and attributes of root
                    var o = '';
                    o += root.toString(true) + '\n';
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<Root/>'
            },
            {
                testNum: 78,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XAttribute("Att1", 1),
                        new XAttribute("Att2", 2),
                        new XAttribute("Att3", 3),
                        new XElement("Child1", 1),
                        new XElement("Child2", 2),
                        new XElement("Child3", 3)
                    );
                    root.removeAttributes();
                    var o = '';
                    o += root.toString(true) + '\n';
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<Root>\n' +
                    '  <Child1>1</Child1>\n' +
                    '  <Child2>2</Child2>\n' +
                    '  <Child3>3</Child3>\n' +
                    '</Root>'
            },
            {
                testNum: 79,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XAttribute("Att1", 1),
                        new XAttribute("Att2", 2),
                        new XAttribute("Att3", 3),
                        new XElement("Child1", 1),
                        new XElement("Child2", 2),
                        new XElement("Child3", 3)
                    );
                    root.replaceAttributes(
                        new XAttribute("Foo1", 1),
                        new XAttribute("Foo2", 2));
                    var o = '';
                    o += root.toString(true) + '\n';
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<Root Foo1=\'1\'\n' +
                    '      Foo2=\'2\'>\n' +
                    '  <Child1>1</Child1>\n' +
                    '  <Child2>2</Child2>\n' +
                    '  <Child3>3</Child3>\n' +
                    '</Root>'
            },
            {
                testNum: 80,
                testFunc: function () {
                    var o = '';

                    // Create an element with no content.
                    var root = new XElement("Root");

                    // Add some name/value pairs.
                    root.setAttributeValue("Att1", 1);
                    root.setAttributeValue("Att2", 2);
                    root.setAttributeValue("Att3", 3);
                    o += checkParentage(root);
                    o += root.toString(true);

                    // Modify one of the name/value pairs.
                    root.setAttributeValue("Att2", 22);
                    o += checkParentage(root);
                    o += root.toString(true);

                    // Remove one of the name/value pairs.
                    root.setAttributeValue("Att3", null);
                    o += root.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<Root Att1=\'1\'\n' +
                    '      Att2=\'2\'\n' +
                    '      Att3=\'3\'/>\n' +
                    '<Root Att1=\'1\'\n' +
                    '      Att2=\'22\'\n' +
                    '      Att3=\'3\'/>\n' +
                    '<Root Att1=\'1\'\n' +
                    '      Att2=\'22\'/>'
            },
            {
                testNum: 81,
                testFunc: function () {
                    var o = '';

                    // Create an element with no content
                    var root = new XElement("Root");

                    // Add some name/value pairs.
                    root.setElementValue("Ele1", 1);
                    root.setElementValue("Ele2", 2);
                    root.setElementValue("Ele3", 3);
                    o += checkParentage(root);
                    o += root.toString(true);

                    // Modify one of the name/value pairs.
                    root.setElementValue("Ele2", 22);
                    o += checkParentage(root);
                    o += root.toString(true);

                    // Remove one of the name/value pairs.
                    root.setElementValue("Ele3", null);
                    o += checkParentage(root);
                    o += root.toString(true);
                    return o;
                },
                output:
                    '<Root>\n' +
                    '  <Ele1>1</Ele1>\n' +
                    '  <Ele2>2</Ele2>\n' +
                    '  <Ele3>3</Ele3>\n' +
                    '</Root>\n' +
                    '<Root>\n' +
                    '  <Ele1>1</Ele1>\n' +
                    '  <Ele2>22</Ele2>\n' +
                    '  <Ele3>3</Ele3>\n' +
                    '</Root>\n' +
                    '<Root>\n' +
                    '  <Ele1>1</Ele1>\n' +
                    '  <Ele2>22</Ele2>\n' +
                    '</Root>'
            },
            {
                testNum: 82,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XElement("Child", "child content")
                    );
                    if (Object.defineProperties)
                        root.value = "new content";
                    else
                        root.setValue("new content");
                    var o = '';
                    o += root.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<Root>new content</Root>'
            },
            {
                testNum: 83,
                testFunc: function () {
                    var el = XElement.parse("<Root>This is <b>mixed</b> content</Root>");
                    var o = '';
                    if (Object.defineProperties) {
                        o += el.value + '\n';
                        o += checkParentage(el);
                        el.value = "new content";
                    }
                    else {
                        o += el.getValue() + '\n';
                        o += checkParentage(el);
                        el.setValue("new content");
                    }
                    o += el.toString(true);
                    o += checkParentage(el);
                    return o;
                },
                output:
                    'This is mixed content\n' +
                    '<Root>new content</Root>'
            },
            {
                testNum: 84,
                testFunc: function () {
                    var root = new XDocument(
                        new XElement("root", 1)
                    );
                    var o = '';
                    o += root.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<root>1</root>'
            },
            {
                testNum: 85,
                testFunc: function () {
                    var xdec = new XDeclaration("1.0", "UTF-8", "yes");
                    var root = new XDocument(xdec, new XElement("Root"));
                    var o = '';
                    o += root.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<Root/>'
            },
            {
                testNum: 86,
                testFunc: function () {
                    var xdec = new XDeclaration("1.0", "UTF-8", "yes");
                    var root = new XDocument(xdec,
                        new XComment("this is a comment at the root of the document"),
                        new XElement("Root"));
                    var o = '';
                    o += root.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<!--this is a comment at the root of the document-->\n' +
                    '<Root/>'
            },
            {
                testNum: 87,
                testFunc: function () {
                    var xdec = new XDeclaration("1.0", "UTF-8", "yes");
                    var root = new XDocument(xdec,
                    new XProcessingInstruction("mso-application", "progid=\"Word.Document\""),
                    new XElement("Root"));
                    var o = '';
                    o += root.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    '<Root/>'
            },
            {
                testNum: 88,
                testFunc: function () {
                    var xdec = new XDeclaration("1.0", "UTF-8", "yes");
                    var root = new XDocument(xdec,
                    new XProcessingInstruction("mso-application", "progid=\"Word.Document\""),
                    new XElement("Root",
                        new XElement("Child", 1),
                        new XElement("Child", 2),
                        new XProcessingInstruction("boo", "yar"),
                        new XElement("Child", 3)));
                    var root2 = new XDocument(root);
                    var o = '';
                    o += root.toString(true);
                    o += '=====\n';
                    o += root2.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    '<Root>\n' +
                    '  <Child>1</Child>\n' +
                    '  <Child>2</Child>\n' +
                    '  <?boo yar?>\n' +
                    '  <Child>3</Child>\n' +
                    '</Root>\n' +
                    '=====\n' +
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    '<Root>\n' +
                    '  <Child>1</Child>\n' +
                    '  <Child>2</Child>\n' +
                    '  <?boo yar?>\n' +
                    '  <Child>3</Child>\n' +
                    '</Root>'
            },
            {
                testNum: 89,
                testFunc: function () {
                    var xdec = new XDeclaration("1.0", "UTF-8", "yes");
                    var root = new XDocument(xdec,
                    new XProcessingInstruction("mso-application", "progid=\"Word.Document\""),
                    new XElement("Root",
                        new XElement("Child", 1),
                        new XElement("Child", 2),
                        new XProcessingInstruction("boo", "yar"),
                        new XElement("Child", 3)));
                    var d = root.descendants().toArray();
                    var o = '';
                    for (var i = 0; i < d.length; i++) {
                        o += d[i].name + '\n';
                    }
                    o += checkParentage(root);
                    return o;
                },
                output:
                    'Root\n' +
                    'Child\n' +
                    'Child\n' +
                    'Child'
            },
            {
                testNum: 90,
                testFunc: function () {
                    var txt;

                    txt = "<bookstore xmlns='http://www.ericwhite.com'><book>";
                    txt = txt + "<title>Everyday Italian</title>";
                    txt = txt + "<author>Giada De Laurentiis</author>";
                    txt = txt + "<year>2005</year>";
                    txt = txt + "</book></bookstore>";
                    var d = XDocument.parse(txt);
                    var o = '';
                    o += d.toString(true);
                    o += checkParentage(d);
                    return o;
                },
                output:
                    '<?xml version="1.0" standalone="no"?>\n' +
                    '<bookstore xmlns=\'http://www.ericwhite.com\'>\n' +
                    '  <book>\n' +
                    '    <title>Everyday Italian</title>\n' +
                    '    <author>Giada De Laurentiis</author>\n' +
                    '    <year>2005</year>\n' +
                    '  </book>\n' +
                    '</bookstore>',
                output2:
                    '<?xml standalone="no"?>\n' +
                    '<bookstore xmlns=\'http://www.ericwhite.com\'>\n' +
                    '  <book>\n' +
                    '    <title>Everyday Italian</title>\n' +
                    '    <author>Giada De Laurentiis</author>\n' +
                    '    <year>2005</year>\n' +
                    '  </book>\n' +
                    '</bookstore>',
                output3:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<bookstore xmlns=\'http://www.ericwhite.com\'>\n' +
                    '  <book>\n' +
                    '    <title>Everyday Italian</title>\n' +
                    '    <author>Giada De Laurentiis</author>\n' +
                    '    <year>2005</year>\n' +
                    '  </book>\n' +
                    '</bookstore>'
            },
            {
                testNum: 91,
                testFunc: function () {
                    var txt;

                    txt = '<?xml version="1.0" encoding="utf-8" standalone="yes"?>' +
                          '<?mso-application progid="Word.Document"?>' +
                          '<bookstore xmlns="http://www.ericwhite.com"><book>' +
                          '<title>Everyday Italian</title>' +
                          '<author>Giada De Laurentiis</author>' +
                          '<year>2005</year>' +
                          '</book></bookstore>';
                    var d = XDocument.parse(txt);
                    var o = '';
                    o += d.toString(true);
                    o += checkParentage(d);
                    return o;
                },
                output:
                // it seems that XMLDocument does not surface encoding or standalone properly
                // but only in IE
                    '<?xml version="1.0" standalone="no"?>\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    '<bookstore xmlns=\'http://www.ericwhite.com\'>\n' +
                    '  <book>\n' +
                    '    <title>Everyday Italian</title>\n' +
                    '    <author>Giada De Laurentiis</author>\n' +
                    '    <year>2005</year>\n' +
                    '  </book>\n' +
                    '</bookstore>',
                output2:
                    '<?xml version="1.0" encoding="utf-8" standalone="yes"?>\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    '<bookstore xmlns=\'http://www.ericwhite.com\'>\n' +
                    '  <book>\n' +
                    '    <title>Everyday Italian</title>\n' +
                    '    <author>Giada De Laurentiis</author>\n' +
                    '    <year>2005</year>\n' +
                    '  </book>\n' +
                    '</bookstore>',
                output3:
                    '<?xml standalone="no"?>\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    '<bookstore xmlns=\'http://www.ericwhite.com\'>\n' +
                    '  <book>\n' +
                    '    <title>Everyday Italian</title>\n' +
                    '    <author>Giada De Laurentiis</author>\n' +
                    '    <year>2005</year>\n' +
                    '  </book>\n' +
                    '</bookstore>',
                output4:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    '<bookstore xmlns=\'http://www.ericwhite.com\'>\n' +
                    '  <book>\n' +
                    '    <title>Everyday Italian</title>\n' +
                    '    <author>Giada De Laurentiis</author>\n' +
                    '    <year>2005</year>\n' +
                    '  </book>\n' +
                    '</bookstore>'
            },
            {
                testNum: 92,
                testFunc: function () {
                    var txt;

                    txt = '<?xml version="1.0" encoding="utf-8" standalone="yes"?>' +
                          '<?mso-application progid="Word.Document"?>' +
                          '<bs:bookstore xmlns:bs="http://www.ericwhite.com"><bs:book>' +
                          '<bs:title>Everyday Italian</bs:title>' +
                          '<bs:author>Giada De Laurentiis</bs:author>' +
                          '<bs:year><![CDATA[boo yar baz]]></bs:year>' +
                          '</bs:book></bs:bookstore>';
                    var d = XDocument.parse(txt);
                    var o = '';
                    o += d.toString(true);
                    o += checkParentage(d);
                    return o;
                },
                output:
                    '<?xml version="1.0" standalone="no"?>\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    '<bs:bookstore xmlns:bs=\'http://www.ericwhite.com\'>\n' +
                    '  <bs:book>\n' +
                    '    <bs:title>Everyday Italian</bs:title>\n' +
                    '    <bs:author>Giada De Laurentiis</bs:author>\n' +
                    '    <bs:year>\n' +
                    '      <![CDATA[boo yar baz]]>\n' +
                    '    </bs:year>\n' +
                    '  </bs:book>\n' +
                    '</bs:bookstore>',
                output2:
                    '<?xml version="1.0" encoding="utf-8" standalone="yes"?>\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    '<bs:bookstore xmlns:bs=\'http://www.ericwhite.com\'>\n' +
                    '  <bs:book>\n' +
                    '    <bs:title>Everyday Italian</bs:title>\n' +
                    '    <bs:author>Giada De Laurentiis</bs:author>\n' +
                    '    <bs:year>\n' +
                    '      <![CDATA[boo yar baz]]>\n' +
                    '    </bs:year>\n' +
                    '  </bs:book>\n' +
                    '</bs:bookstore>',
                output3:
                    '<?xml standalone="no"?>\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    '<bs:bookstore xmlns:bs=\'http://www.ericwhite.com\'>\n' +
                    '  <bs:book>\n' +
                    '    <bs:title>Everyday Italian</bs:title>\n' +
                    '    <bs:author>Giada De Laurentiis</bs:author>\n' +
                    '    <bs:year>\n' +
                    '      <![CDATA[boo yar baz]]>\n' +
                    '    </bs:year>\n' +
                    '  </bs:book>\n' +
                    '</bs:bookstore>',
                output4:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    '<bs:bookstore xmlns:bs=\'http://www.ericwhite.com\'>\n' +
                    '  <bs:book>\n' +
                    '    <bs:title>Everyday Italian</bs:title>\n' +
                    '    <bs:author>Giada De Laurentiis</bs:author>\n' +
                    '    <bs:year>\n' +
                    '      <![CDATA[boo yar baz]]>\n' +
                    '    </bs:year>\n' +
                    '  </bs:book>\n' +
                    '</bs:bookstore>'
            },
        /*
        {
        testNum: 93,
        testFunc: function () {
        var aw = XNamespace.get("http://www.adventureworks.com");
        var root = new XElement(aw + "root",
        new XAttribute(XNamespace.getXmlns() + "aw", aw.namespaceName),
        new XAttribute("boo", "yar"),
        new XAttribute(aw + "foo2", "bar2"),
        new XElement(aw + "child", 123));
        var prefix = root.getPrefixOfNamespace(aw);
        var o = '';
        o += root.toString(true);
        o += "======================\n";
        o += "prefix: " + prefix + '\n';
        return o;
        },
        output:
        '<aw:root boo=\'yar\'\n' +
        '         aw:foo2=\'bar2\'\n' +
        '         xmlns:aw=\'http://www.adventureworks.com\'>\n' +
        '  <aw:child>123</aw:child>\n' +
        '</aw:root>\n' +
        '======================\n' +
        'prefix: aw'
        },
        */
            {
            testNum: 94,
            testFunc: function () {
                var txt;

                txt = '<bs:bookstore xmlns:bs="http://www.ericwhite.com">fff</bs:bookstore>';
                var d = XDocument.parse(txt);
                var o = '';
                o += d.toString(true);
                o += checkParentage(d);
                return o;
            },
            output:
                    '<?xml version="1.0" standalone="no"?>\n' +
                    '<bs:bookstore xmlns:bs=\'http://www.ericwhite.com\'>fff</bs:bookstore>',
            output2:
                    '<?xml standalone="no"?>\n' +
                    '<bs:bookstore xmlns:bs=\'http://www.ericwhite.com\'>fff</bs:bookstore>',
            output3:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<bs:bookstore xmlns:bs=\'http://www.ericwhite.com\'>fff</bs:bookstore>'
        },
            {
                testNum: 95,
                testFunc: function () {
                    var txt;

                    txt = '<root>f\"ff</root>';
                    var d = XDocument.parse(txt);
                    var o = '';
                    o += d.toString(true);
                    o += checkParentage(d);
                    return o;
                },
                output:
                    '<?xml version="1.0" standalone="no"?>\n' +
                    '<root>f&quot;ff</root>',
                output2:
                    '<?xml standalone="no"?>\n' +
                    '<root>f&quot;ff</root>',
                output3:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<root>f&quot;ff</root>'
            },
            {
                testNum: 96,
                testFunc: function () {
                    var txt;

                    txt = '<root att=\'23\'>f\'ff</root>';
                    var d = XDocument.parse(txt);
                    var o = '';
                    o += d.toString(true);
                    o += checkParentage(d);
                    return o;
                },
                output:
                    '<?xml version="1.0" standalone="no"?>\n' +
                    '<root att=\'23\'>f&apos;ff</root>',
                output2:
                    '<?xml standalone="no"?>\n' +
                    '<root att=\'23\'>f&apos;ff</root>',
                output3:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<root att=\'23\'>f&apos;ff</root>'
            },
            {
                testNum: 97,
                testFunc: function () {
                    var txt;

                    txt = '<root att=\"23\">f\'ff</root>';
                    var d = XDocument.parse(txt);
                    var o = '';
                    o += d.toString(true);
                    o += checkParentage(d);
                    return o;
                },
                output:
                    '<?xml version="1.0" standalone="no"?>\n' +
                    '<root att=\'23\'>f&apos;ff</root>',
                output2:
                    '<?xml standalone="no"?>\n' +
                    '<root att=\'23\'>f&apos;ff</root>',
                output3:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<root att=\'23\'>f&apos;ff</root>'
            },
            {
                testNum: 98,
                testFunc: function () {
                    function transform(node) {
                        if (node.nodeType === 'Element') {
                            var element = node;
                            if (element.name === new XName("c3")) {
                                return new XElement("z3",
                                    element.attributes(),
                                    element.nodes().select(function (n) { return transform(n); }));
                            }
                            if (element.name === new XName("c1")) {
                                return new XElement("foobar",
                                    element.attributes(),
                                    element.nodes().select(function (n) { return transform(n); }));
                            }
                            return new XElement(element.name,
                                element.attributes(),
                                element.nodes().select(function (n) { return transform(n); }));
                        }
                        return node;
                    }

                    var r1 = new XElement("root",
                        new XElement("c1", 123),
                        new XElement("c2", 456),
                        new XElement("c3",
                            new XAttribute("A1", 999),
                            new XElement("Text", "text")));

                    var r2 = transform(r1);

                    var o = '';
                    o += r1.toString(true);
                    o += '========================\n';
                    o += r2.toString(true);

                    o += checkParentage(r1);
                    o += checkParentage(r2);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <c1>123</c1>\n' +
                    '  <c2>456</c2>\n' +
                    '  <c3 A1=\'999\'>\n' +
                    '    <Text>text</Text>\n' +
                    '  </c3>\n' +
                    '</root>\n' +
                    '========================\n' +
                    '<root>\n' +
                    '  <foobar>123</foobar>\n' +
                    '  <c2>456</c2>\n' +
                    '  <z3 A1=\'999\'>\n' +
                    '    <Text>text</Text>\n' +
                    '  </z3>\n' +
                    '</root>'
            },
            {
                testNum: 99,
                testFunc: function () {
                    function transform(node) {
                        if (node.nodeType === 'Element') {
                            var element = node;
                            if (element.name === new XName("c3")) {
                                return new XElement("z3",
                                    element.attributes(),
                                    element.nodes().select(function (n) { return transform(n); }));
                            }
                            if (element.name === new XName("c1")) {
                                return new XElement("foobar",
                                    element.attributes(),
                                    element.nodes().select(function (n) { return transform(n); }));
                            }
                            return new XElement(element.name,
                                element.attributes(),
                                element.nodes().select(function (n) { return transform(n); }));
                        }
                        return node;
                    }

                    var r1 = new XElement("root",
                        new XElement("c1", 123),
                        new XElement("c2", 456),
                        new XElement("c3",
                            new XAttribute("A1", 999),
                            new XElement("Text", "text")));

                    var r2 = transform(r1);

                    var o = '';
                    o += r1.toString(true);
                    o += '========================\n';
                    o += r2.toString(true);

                    o += checkParentage(r1);
                    o += checkParentage(r2);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <c1>123</c1>\n' +
                    '  <c2>456</c2>\n' +
                    '  <c3 A1=\'999\'>\n' +
                    '    <Text>text</Text>\n' +
                    '  </c3>\n' +
                    '</root>\n' +
                    '========================\n' +
                    '<root>\n' +
                    '  <foobar>123</foobar>\n' +
                    '  <c2>456</c2>\n' +
                    '  <z3 A1=\'999\'>\n' +
                    '    <Text>text</Text>\n' +
                    '  </z3>\n' +
                    '</root>'
            },
            {
                testNum: 100,
                testFunc: function () {
                    var o;

                    var r = new XElement("root",
                        new XElement("c1", 1),
                        new XElement("c2", 2),
                        new XElement("c1", 3),
                        new XElement("c1", 4),
                        new XElement("c2", 5));
                    var r2 = new XElement("root",
                        r.elements("c2"));
                    o = '';
                    o += r2.toString(true);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <c2>2</c2>\n' +
                    '  <c2>5</c2>\n' +
                    '</root>'
            },
            {
                testNum: 101,
                testFunc: function () {
                    var o;

                    var r = new XElement("root",
                        new XElement("c1",
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d2", 7)));
                    var r2 = new XElement("root",
                        r.elements("c2").asXEnumerable().elements("d1"));
                    var r3 = new XElement("root",
                        r.elements().asXEnumerable().elements("d1"));
                    o = '';
                    o += r2.toString(true);
                    o += '========================\n';
                    o += r3.toString(true);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <d1>3</d1>\n' +
                    '</root>\n' +
                    '========================\n' +
                    '<root>\n' +
                    '  <d1>1</d1>\n' +
                    '  <d1>3</d1>\n' +
                    '  <d1>4</d1>\n' +
                    '  <d1>6</d1>\n' +
                    '</root>'
            },
            {
                testNum: 102,
                testFunc: function () {
                    var o;

                    var r = new XElement("root",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d2", 7)));
                    var r2 = new XElement("root",
                        r.elements("c1").asXEnumerable().attributes("boo").firstOrDefault());
                    var r3 = new XElement("root",
                        r.elements().asXEnumerable().attributes());
                    o = '';
                    o += r2.toString(true);
                    o += '========================\n';
                    o += r3.toString(true);
                    return o;
                },
                output:
                    '<root boo=\'101\'/>\n' +
                    '========================\n' +
                    '<root boo=\'101\'\n' +
                    '      yar=\'102\'/>'
            },
            {
                testNum: 103,
                testFunc: function () {
                    var o;

                    var r = new XElement("root",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d2", 7)));
                    var r2 = new XElement("root",
                        r.elements("c2").asXEnumerable().descendants("d2").firstOrDefault());
                    var r3 = new XElement("root",
                        r.elements().asXEnumerable().descendants());
                    o = '';
                    o += r2.toString(true);
                    o += '========================\n';
                    o += r3.toString(true);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <d2>2</d2>\n' +
                    '</root>\n' +
                    '========================\n' +
                    '<root>\n' +
                    '  <d1>1</d1>\n' +
                    '  <d2>2</d2>\n' +
                    '  <d1>3</d1>\n' +
                    '  <d1>4</d1>\n' +
                    '  <d2>5</d2>\n' +
                    '  <d1>6</d1>\n' +
                    '  <d2>7</d2>\n' +
                    '</root>'
            },
            {
                testNum: 104,
                testFunc: function () {
                    var r = new XElement("root",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));
                    var r2 = r.descendants("d2").asXEnumerable().ancestorsAndSelf().toArray();
                    var o = '';
                    for (var i = 0; i < r2.length; i++) {
                        o += r2[i].name + '\n';
                    }
                    return o;
                },
                output:
                    'd2\n' +
                    'c2\n' +
                    'root\n' +
                    'd2\n' +
                    'c1\n' +
                    'root'
            },
            {
                testNum: 105,
                testFunc: function () {
                    var e1 = new XElement("root1");
                    var e2 = new XElement("root2");
                    e1.addAnnotation("boo", 1);
                    var o = '';
                    o += e1.annotations("boo").count().toString() + '\n';
                    o += e2.annotations("boo").count().toString() + '\n';
                    return o;
                },
                output:
                    '1\n' +
                    '0'
            },
            {
                testNum: 106,
                testFunc: function () {
                    var e = new XNamespace("http://www.ericwhite.com/");
                    var r = new XElement(e + "root",
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XElement(e + "c", 1));
                    var o = '';
                    o += r.toString(true);
                    o += "=====================\n";
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<e:root xmlns:e=\'http://www.ericwhite.com/\'>\n' +
                    '  <e:c>1</e:c>\n' +
                    '</e:root>\n' +
                    '=====================\n' +
                    '<e:root xmlns:e=\'http://www.ericwhite.com/\'>\n' +
                    '  <e:c>1</e:c>\n' +
                    '</e:root>'
            },
            {
                testNum: 107,
                testFunc: function () {
                    var e = new XNamespace('http://www.ericwhite.com/');
                    var x = "<e:root xmlns:e='http://www.ericwhite.com/'><e:c>1</e:c></e:root>";
                    var r = XElement.parse(x);
                    var o = '';
                    o += r.name.toString() + '\n';
                    var z = new XName(e + "root");
                    o += z.toString() + '\n'; ;
                    o += r.toString(true);
                    o += "=====================\n";
                    o += r.toString(true);
                    return o;
                },
                output:
                    '{http://www.ericwhite.com/}root\n' +
                    '{http://www.ericwhite.com/}root\n' +
                    '<e:root xmlns:e=\'http://www.ericwhite.com/\'>\n' +
                    '  <e:c>1</e:c>\n' +
                    '</e:root>\n' +
                    '=====================\n' +
                    '<e:root xmlns:e=\'http://www.ericwhite.com/\'>\n' +
                    '  <e:c>1</e:c>\n' +
                    '</e:root>'
            },
            {
                testNum: 108,
                testFunc: function () {
                    var n = new XNamespace.getNone();
                    var n2 = new XNamespace.getNone();
                    var e = n.getName("boo");
                    var e2 = new XName("{http://www.ericwhite.com/}yar");
                    var o = '';
                    o += n.toString() + '\n';
                    o += n2.toString() + '\n';
                    o += e.toString() + '\n';
                    o += e2.toString() + '\n';
                    return o;
                },
                output:
                    '\n' +
                    '\n' +
                    'boo\n' +
                    '{http://www.ericwhite.com/}yar'
            },
            {
                testNum: 109,
                testFunc: function () {
                    var xdec = new XDeclaration("1.0", "UTF-8", "yes");
                    var root = new XDocument(xdec,
                    new XProcessingInstruction("mso-application", "progid=\"Word.Document\""),
                    new XElement("Root",
                        new XElement("Child", 1),
                        new XElement("Child", 2),
                        new XProcessingInstruction("boo", "yar"),
                        new XElement("Child", 3)));

                    var ttt = root.descendants("Child").toArray();

                    if (Object.defineProperties) {
                        var c3 = root
                            .descendants("Child")
                            .where(function (f) {
                                return f.value === '3';
                            }).firstOrDefault();
                    }
                    else {
                        var c3 = root
                            .descendants("Child")
                            .where(function (f) {
                                return f.getValue() === '3';
                            }).firstOrDefault();
                    }
                    var d3 = c3.getDocument();
                    var xpi1 = root.descendantNodes().firstOrDefault(function (f) { return f.nodeType === 'ProcessingInstruction'; });
                    var o = '';
                    o += root.toString(true);
                    o += (d3 === root).toString() + '\n';
                    o += xpi1.toString(true);
                    o += 'Target: ' + xpi1.target + '\n';
                    o += 'Data: ' + xpi1.data + '\n';
                    xpi1.target = "a1";
                    xpi1.data = "d1";
                    o += 'Target: ' + xpi1.target + '\n';
                    o += 'Data: ' + xpi1.data + '\n';
                    o += root.toString(true);
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    '<Root>\n' +
                    '  <Child>1</Child>\n' +
                    '  <Child>2</Child>\n' +
                    '  <?boo yar?>\n' +
                    '  <Child>3</Child>\n' +
                    '</Root>\n' +
                    'true\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    'Target: mso-application\n' +
                    'Data: progid="Word.Document"\n' +
                    'Target: a1\n' +
                    'Data: d1\n' +
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<?a1 d1?>\n' +
                    '<Root>\n' +
                    '  <Child>1</Child>\n' +
                    '  <Child>2</Child>\n' +
                    '  <?boo yar?>\n' +
                    '  <Child>3</Child>\n' +
                    '</Root>'
            },
            {
                testNum: 110,
                testFunc: function () {
                    var o = '';
                    var c1 = new XElement("Root",
                    new XAttribute("att1", 123),
                    new XAttribute("att2", 456));
                    var c2 = new XElement("Root",
                    new XAttribute("att1", 1234),
                    new XAttribute("att2", 456));
                    o += c1.deepEquals(c2).toString() + '\n';                  // false
                    o += checkParentage(c1);
                    o += checkParentage(c2);

                    var c1 = new XElement("Root",
                    new XAttribute("att1", 123),
                    new XAttribute("att2", 456));
                    var c2 = new XElement("Root",
                    new XAttribute("att1b", 1234),
                    new XAttribute("att2", 456));
                    o += c1.deepEquals(c2).toString() + '\n';                  // false
                    o += checkParentage(c1);
                    o += checkParentage(c2);

                    var e1 = new XElement("root",
                    new XElement("child1", 111),
                    new XElement("child2", 222),
                    new XElement("child3", 333));
                    var e2 = new XElement("root",
                    new XComment("c1"),
                    new XElement("child2", 222),
                    new XElement("child3", 333));
                    o += e1.deepEquals(e2).toString() + '\n';                  // false
                    o += checkParentage(e1);
                    o += checkParentage(e2);

                    return o;
                },
                output:
                    'false\n' +
                    'false\n' +
                    'false'
            },
            {
                testNum: 111,
                testFunc: function () {
                    var r = new XElement("root",
                        new XAttribute("a1", 1));
                    var v = r.attribute("a1").value;

                    var o = '';
                    o += v.toString() + '\n';
                    r.attribute("a1").value = 123;
                    o += r.toString(true);
                    var a = r.attribute("a1");
                    if (a.getPreviousAttribute() === null)
                        o += "true\n";
                    return o;
                },
                output:
                    '1\n' +
                    '<root a1=\'123\'/>\n' +
                    'true'
            },
            {
                testNum: 112,
                testFunc: function () {
                    var xdec = new XDeclaration("1.0", "UTF-8", "yes");
                    var root = new XDocument(xdec,
                        new XComment("c"),
                        new XElement("r"));
                    var root2 = new XDocument(root);
                    var o = '';
                    o += root2.toString(false);
                    o += checkParentage(root);
                    o += checkParentage(root2);
                    return o;
                },
                output:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?><!--c--><r/>'
            },
            {
                testNum: 113,
                testFunc: function () {
                    var r = new XDocument(
                        new XElement("r",
                            new XElement("c",
                                new XElement("gc"))));
                    var root = r.getRoot();
                    var gc = r.descendants("gc").firstOrDefault();
                    var anc = gc.ancestorsAndSelf("c").firstOrDefault();
                    var anc2 = gc.ancestorsAndSelf("gc").firstOrDefault();
                    var o = '';
                    o += root.name.toString() + '\n';
                    o += anc.toString(true);
                    o += anc2.toString(true);
                    return o;
                },
                output:
                    'r\n' +
                    '<c>\n' +
                    '  <gc/>\n' +
                    '</c>\n' +
                    '<gc/>'
            },
            {
                testNum: 114,
                testFunc: function () {
                    var e = new XElement("r",
                        new XAttribute("a1", 1),
                        new XAttribute("a2", 2));
                    var o = '';
                    o += e.toString(true);
                    return o;
                },
                output:
                    '<r a1=\'1\'\n' +
                    '   a2=\'2\'/>'
            },
            {
                testNum: 115,
                testFunc: function () {
                    var xml = "<r xml:space='preserve' e:a='123' xmlns:e='http://www.ericwhite.com/'> a b c </r>";
                    var r = XElement.parse(xml);
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<r e:a=\'123\'\n' +
                    '   xmlns:e=\'http://www.ericwhite.com/\'\n' +
                    '   xml:space=\'preserve\'> a b c </r>',
                output2:
                    '<r e:a=\'123\'\n' +
                    '   xml:space=\'preserve\'\n' +
                    '   xmlns:e=\'http://www.ericwhite.com/\'> a b c </r>'
            },
            {
                testNum: 116,
                testFunc: function () {
                    var xml = "<r xml:space='preserve' b='456' a:c='789' e:a='123' xmlns:e='http://www.ericwhite.com/' xmlns:a='http://www.adventureworks.com/'> a b c </r>";
                    var r = XElement.parse(xml);
                    var xml2 = '<r xmlns:a=\'http://www.adventureworks.com/\'\n' +
                    '   e:a=\'123\'\n' +
                    '   xmlns:e=\'http://www.ericwhite.com/\'\n' +
                    '   a:c=\'789\'\n' +
                    '   b=\'456\'\n' +
                    '   xml:space=\'preserve\'> a b c </r>';
                    var r2 = XElement.parse(xml2);
                    var o = '';
                    o += r.toString(true);
                    o += '========================\n';
                    o += r2.toString(true);
                    o += '========================\n';
                    o += r.deepEquals(r2).toString();
                    return o;
                },
                output:
                    '<r b=\'456\'\n' +
                    '   a:c=\'789\'\n' +
                    '   e:a=\'123\'\n' +
                    '   xmlns:a=\'http://www.adventureworks.com/\'\n' +
                    '   xmlns:e=\'http://www.ericwhite.com/\'\n' +
                    '   xml:space=\'preserve\'> a b c </r>\n' +
                    '========================\n' +
                    '<r b=\'456\'\n' +
                    '   a:c=\'789\'\n' +
                    '   e:a=\'123\'\n' +
                    '   xmlns:a=\'http://www.adventureworks.com/\'\n' +
                    '   xmlns:e=\'http://www.ericwhite.com/\'\n' +
                    '   xml:space=\'preserve\'> a b c </r>\n' +
                    '========================\n' +
                    'true',
                output2:
                    '<r b=\'456\'\n' +
                    '   a:c=\'789\'\n' +
                    '   e:a=\'123\'\n' +
                    '   xml:space=\'preserve\'\n' +
                    '   xmlns:a=\'http://www.adventureworks.com/\'\n' +
                    '   xmlns:e=\'http://www.ericwhite.com/\'> a b c </r>\n' +
                    '========================\n' +
                    '<r b=\'456\'\n' +
                    '   a:c=\'789\'\n' +
                    '   e:a=\'123\'\n' +
                    '   xml:space=\'preserve\'\n' +
                    '   xmlns:a=\'http://www.adventureworks.com/\'\n' +
                    '   xmlns:e=\'http://www.ericwhite.com/\'> a b c </r>\n' +
                    '========================\n' +
                    'true'
            },
            {
                testNum: 117,
                testFunc: function () {
                    var xdec = new XDeclaration("1.0", "UTF-8", "yes");
                    var root = new XDocument(xdec,
                        new XComment("c"),
                        new XElement("r"));
                    var root2 = new XDocument(root);
                    var o = '';
                    var xd = root.declaration;
                    o += xd.toString(true);
                    o += xd.toString() + '\n';
                    o += '=============================\n';
                    var xd2 = new XDeclaration("1.1", "UTF-16", "no");
                    root.declaration = xd2;
                    o += root.toString(true);
                    return o;
                },
                output:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '=============================\n' +
                    '<?xml version="1.1" encoding="UTF-16" standalone="no"?>\n' +
                    '<!--c-->\n' +
                    '<r/>'
            },
            {
                testNum: 118,
                testFunc: function () {
                    var xdec = new XDeclaration("1.0", "UTF-8", "yes");
                    var root = new XDocument(xdec,
                    new XProcessingInstruction("mso-application", "progid=\"Word.Document\""),
                    new XElement("Root"));
                    var xpi = root.descendantNodes().firstOrDefault(function (n) { return n.nodeType === 'ProcessingInstruction'; });

                    var o = '';
                    o += root.toString(true);
                    o += "======\n";
                    o += xpi.toString(false) + '\n';
                    o += xpi.data + '\n';
                    o += xpi.target + '\n';
                    xpi.data = "loo";
                    xpi.target = "baa";
                    o += xpi.data + '\n';
                    o += xpi.target + '\n';
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    '<Root/>\n' +
                    '======\n' +
                    '<?mso-application progid="Word.Document"?>\n' +
                    'progid="Word.Document"\n' +
                    'mso-application\n' +
                    'loo\n' +
                    'baa'
            },
            {
                testNum: 119,
                testFunc: function () {
                    var x = new XElement("Text", 123);
                    var t = x.descendantNodes().firstOrDefault(function (f) { return f.nodeType === 'Text'; });
                    var o = '';
                    o += t.toString(true) + '\n';
                    o += t.toString(false) + '\n';
                    o += t.value + '\n';
                    t.value = "abc";
                    o += x.toString(true);
                    return o;
                },
                output:
                    '123\n' +
                    '123\n' +
                    '123\n' +
                    '<Text>abc</Text>'
            },
            {
                testNum: 120,
                testFunc: function () {
                    var x = new XElement("root",
                        new XElement("child"),
                        new XCData("this is CDATA\nthis is on a second line\na third line is here"),
                        new XElement("child"));
                    var cd = x.descendantNodes().firstOrDefault(function (f) { return f.nodeType === 'CDATA'; });
                    var o = '';
                    o += x.toString(true);
                    o += cd.value + '\n';
                    cd.value = "zzzzz";
                    o += cd.value + '\n';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <child/>\n' +
                    '  <![CDATA[this is CDATA\n' +
                    'this is on a second line\n' +
                    'a third line is here]]>\n' +
                    '  <child/>\n' +
                    '</root>\n' +
                    'this is CDATA\n' +
                    'this is on a second line\n' +
                    'a third line is here\n' +
                    'zzzzz\n' +
                    '<root>\n' +
                    '  <child/>\n' +
                    '  <![CDATA[zzzzz]]>\n' +
                    '  <child/>\n' +
                    '</root>'
            },
            {
                testNum: 121,
                testFunc: function () {
                    var r = new XElement("root",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));
                    var r2 = r.descendants("d2").asXEnumerable().ancestorsAndSelf("c2").toArray();
                    var r3 = r.descendants("d2").asXEnumerable().ancestors("c2").toArray();
                    var r4 = r.descendants("d2").asXEnumerable().ancestors().toArray();
                    var o = '';
                    for (var i = 0; i < r2.length; i++) {
                        o += r2[i].name + '\n';
                    }
                    o += '=====\n';
                    for (var i = 0; i < r3.length; i++) {
                        o += r3[i].name + '\n';
                    }
                    o += '=====\n';
                    for (var i = 0; i < r4.length; i++) {
                        o += r4[i].name + '\n';
                    }
                    o += '=====\n';
                    return o;

                },
                output:
                    'c2\n' +
                    '=====\n' +
                    'c2\n' +
                    '=====\n' +
                    'c2\n' +
                    'root\n' +
                    'c1\n' +
                    'root\n' +
                    '====='
            },
            {
                testNum: 122,
                testFunc: function () {
                    var r = new XElement("d2",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));
                    var r2 = r.elements().asXEnumerable().descendantNodesAndSelf().toArray();
                    var r3 = r.elements().asXEnumerable().descendantsAndSelf("d2").toArray();
                    var r4 = r.elements().asXEnumerable().nodes().toArray();
                    var o = '';
                    for (var i = 0; i < r2.length; i++) {
                        o += r2[i].nodeType + (r2[i].nodeType === 'Element' ? (" " + r2[i].name) : "") + '\n';
                    }
                    o += '=====\n';
                    for (var i = 0; i < r3.length; i++) {
                        o += r3[i].name + '\n';
                    }
                    o += '=====\n';
                    for (var i = 0; i < r4.length; i++) {
                        o += r4[i].nodeType + (r4[i].nodeType === 'Element' ? (" " + r4[i].name) : "") + '\n';
                    }
                    return o;
                },
                output:
                    'Element c1\n' +
                    'Element d1\n' +
                    'Text\n' +
                    'Element c2\n' +
                    'Element d2\n' +
                    'Text\n' +
                    'Element d1\n' +
                    'Text\n' +
                    'Element c1\n' +
                    'Element d1\n' +
                    'Text\n' +
                    'Element d2\n' +
                    'Text\n' +
                    'Element c1\n' +
                    'Element d1\n' +
                    'Text\n' +
                    'Element c2\n' +
                    'Element d1\n' +
                    'Text\n' +
                    '=====\n' +
                    'd2\n' +
                    'd2\n' +
                    '=====\n' +
                    'Element d1\n' +
                    'Element d2\n' +
                    'Element d1\n' +
                    'Element d1\n' +
                    'Element d2\n' +
                    'Element d1\n' +
                    'Element d1'
            },
            {
                testNum: 123,
                testFunc: function () {
                    var r = new XElement("d2",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));

                    r.elements().asXEnumerable().elements().remove();
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<d2>\n' +
                    '  <c1 boo=\'101\'/>\n' +
                    '  <c2/>\n' +
                    '  <c1 yar=\'102\'/>\n' +
                    '  <c1/>\n' +
                    '  <c2/>\n' +
                    '</d2>'
            },
            {
                testNum: 124,
                testFunc: function () {
                    var r = new XElement("d2",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XComment("boo"),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));

                    r.elements().asXEnumerable().attributes().remove();
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<d2>\n' +
                    '  <c1>\n' +
                    '    <d1>1</d1>\n' +
                    '  </c1>\n' +
                    '  <c2>\n' +
                    '    <d2>2</d2>\n' +
                    '    <!--boo-->\n' +
                    '    <d1>3</d1>\n' +
                    '  </c2>\n' +
                    '  <c1>\n' +
                    '    <d1>4</d1>\n' +
                    '    <d2>5</d2>\n' +
                    '  </c1>\n' +
                    '  <c1>\n' +
                    '    <d1>6</d1>\n' +
                    '  </c1>\n' +
                    '  <c2>\n' +
                    '    <d1>7</d1>\n' +
                    '  </c2>\n' +
                    '</d2>'
            },
            {
                testNum: 125,
                testFunc: function () {
                    var r = new XElement("d2",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XComment("boo"),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));

                    r.elements().asXEnumerable().elements().remove();
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<d2>\n' +
                    '  <c1 boo=\'101\'/>\n' +
                    '  <c2/>\n' +
                    '  <c1 yar=\'102\'>\n' +
                    '    <!--boo-->\n' +
                    '  </c1>\n' +
                    '  <c1/>\n' +
                    '  <c2/>\n' +
                    '</d2>'
            },
            {
                testNum: 126,
                testFunc: function () {
                    var r = new XElement("d2",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XComment("boo"),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));

                    r.elements().asXEnumerable().nodes().remove();
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<d2>\n' +
                    '  <c1 boo=\'101\'/>\n' +
                    '  <c2/>\n' +
                    '  <c1 yar=\'102\'/>\n' +
                    '  <c1/>\n' +
                    '  <c2/>\n' +
                    '</d2>'
            },
            {
                testNum: 127,
                testFunc: function () {
                    var r = new XElement("d2",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XComment("boo"),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));

                    r.elements().asXEnumerable().elements("d1").remove();
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<d2>\n' +
                    '  <c1 boo=\'101\'/>\n' +
                    '  <c2>\n' +
                    '    <d2>2</d2>\n' +
                    '  </c2>\n' +
                    '  <c1 yar=\'102\'>\n' +
                    '    <!--boo-->\n' +
                    '    <d2>5</d2>\n' +
                    '  </c1>\n' +
                    '  <c1/>\n' +
                    '  <c2/>\n' +
                    '</d2>'
            },
            {
                testNum: 128,
                testFunc: function () {
                    var x = "<r xmlns='http://www.ericwhite.com/' att1='1' " +
                        "e:att2='2' xmlns:e='http://www.ericwhite.com/'>boo</r>";
                    var r = XElement.parse(x);
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<r att1=\'1\'\n' +
                    '   e:att2=\'2\'\n' +
                    '   xmlns:e=\'http://www.ericwhite.com/\'\n' +
                    '   xmlns=\'http://www.ericwhite.com/\'>boo</r>'
            },
            {
                testNum: 129,
                testFunc: function () {
                    var x = '<r xmlns="http://www.ericwhite.com/" ' +
                        'xmlns:e="http://www.ericwhite.com/" ' +
                        'e:att1="1" e:att2="2" att3="3" att4="4">' +
                        '<e:c>' +
                        '<e:gc e:att1="1" e:att2="2" att3="3" e:att4="4">' +
                        'some text' +
                        '</e:gc>' +
                        '</e:c>' +
                        '</r>'
                    var r = XElement.parse(x);
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<r att3=\'3\'\n' +
                    '   att4=\'4\'\n' +
                    '   e:att1=\'1\'\n' +
                    '   e:att2=\'2\'\n' +
                    '   xmlns:e=\'http://www.ericwhite.com/\'\n' +
                    '   xmlns=\'http://www.ericwhite.com/\'>\n' +
                    '  <c>\n' +
                    '    <gc att3=\'3\'\n' +
                    '        e:att1=\'1\'\n' +
                    '        e:att2=\'2\'\n' +
                    '        e:att4=\'4\'>some text</gc>\n' +
                    '  </c>\n' +
                    '</r>'
            },
            {
                testNum: 130,
                testFunc: function () {
                    var e = XNamespace("http://www.ericwhite.com/", "e");
                    var aw = XNamespace("http://www.adventureworks.com/", "aw");

                    var r = new XElement(aw + "r",
                        new XAttribute(XNamespace.getXmlns() + "aw", aw.namespaceName),
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        new XElement(e + "bar", 123));
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<aw:r xmlns:aw=\'http://www.adventureworks.com/\'\n' +
                    '      xmlns:e=\'http://www.ericwhite.com/\'>\n' +
                    '  <e:bar>123</e:bar>\n' +
                    '</aw:r>'
            },
            {
                testNum: 131,
                testFunc: function () {
                    var wordDoc = XElement.parse(
                        "<root>" +
                        "<body>" +
                        "<p>" +
                        "<t>first para</t>" +
                        "</p>" +
                        "<p>" +
                        "<pPr>" +
                        "<style name='heading1'/>" +
                        "</pPr>" +
                        "<t>second para</t>" +
                        "</p>" +
                        "</body>" +
                        "</root>");

                    var p1 = wordDoc.element("body")
                        .elements().toArray();

                    var p2 = wordDoc.element("body")
                        .elements()
                        .select(function (p) {
                            return p.name
                        }).toArray();

                    if (Object.defineProperties) {
                        var paraStyles = wordDoc.element("body")
                            .elements()
                            .select(function (p) {
                                var style = p.elements("pPr")
                                    .asXEnumerable()
                                    .elements("style")
                                    .attributes("name")
                                    .select(function (a) { return a.value; })
                                    .firstOrDefault();
                                if (style === null)
                                    style = "normal";
                                return {
                                    Text: p.descendants("t")
                                        .select(function (t) { return t.value; })
                                        .aggregate("", function (s, i) { return s + i; }),
                                    Style: style
                                };
                            })
                            .toArray();
                    }
                    else {
                        var paraStyles = wordDoc.element("body")
                            .elements()
                            .select(function (p) {
                                var style = p.elements("pPr")
                                    .asXEnumerable()
                                    .elements("style")
                                    .attributes("name")
                                    .select(function (a) { return a.value; })
                                    .firstOrDefault();
                                if (style === null)
                                    style = "normal";
                                return {
                                    Text: p.descendants("t")
                                        .select(function (t) { return t.getValue(); })
                                        .aggregate("", function (s, i) { return s + i; }),
                                    Style: style
                                };
                            })
                            .toArray();
                    }
                    var o = '';
                    o += wordDoc.toString(true);
                    o += paraStyles.length + '\n';
                    for (var i = 0; i < paraStyles.length; i++) {
                        o += paraStyles[i].Style + ":" + paraStyles[i].Text + '\n';
                    }
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <body>\n' +
                    '    <p>\n' +
                    '      <t>first para</t>\n' +
                    '    </p>\n' +
                    '    <p>\n' +
                    '      <pPr>\n' +
                    '        <style name=\'heading1\'/>\n' +
                    '      </pPr>\n' +
                    '      <t>second para</t>\n' +
                    '    </p>\n' +
                    '  </body>\n' +
                    '</root>\n' +
                    '2\n' +
                    'normal:first para\n' +
                    'heading1:second para'
            },
            {
                testNum: 132,
                testFunc: function () {
                    var r1 = new XElement("r1",
                        new XAttribute("a1", 1));
                    var r2 = new XElement("r2",
                        r1.attribute("a1"));
                    var o = '';
                    o += r2.toString(true);
                    return o;
                },
                output:
                    '<r2 a1=\'1\'/>'
            },
            {
                testNum: 133,
                testFunc: function () {
                    if (Object.defineProperties)
                        var ns1 = XNamespace.none;
                    else
                        var ns1 = XNamespace.getNone();
                    var e = XNamespace("http://www.ericwhite.com");

                    var n1 = new XName(ns1, "boo");
                    var n2 = new XName(ns1, "yar");
                    var n3 = new XName(ns1, "baz");
                    var n4 = new XName(ns1, "boo");
                    var n5 = new XName(ns1, "yar");
                    var n6 = new XName(ns1, "yar");

                    var e1 = new XName(e, "boo");
                    var e2 = new XName(e, "yar");
                    var e3 = new XName(e, "baz");
                    var e4 = new XName(e, "boo");
                    var e5 = new XName(e, "yar");
                    var e6 = new XName(e, "yar");

                    var f1 = new XName("diffOverload");

                    var o = '';

                    o += e1.toString() + '\n';
                    o += e2.toString() + '\n';
                    o += f1.toString() + '\n';

                    o += "===========================" + '\n';
                    var o2 = dumpTables();
                    o = o + o2;
                    return o;
                },
                output:
                    '{http://www.ericwhite.com}boo\n' +
                    '{http://www.ericwhite.com}yar\n' +
                    'diffOverload\n' +
                    '===========================\n' +
                    '\n' +
                    'Namespaces\n' +
                    '==========\n' +
                    '__none:\n' +
                    '  namespaceName:__none\n' +
                    '  preferredPrefix:\n' +
                    'http://www.ericwhite.com:\n' +
                    '  namespaceName:http://www.ericwhite.com\n' +
                    '  preferredPrefix:undefined\n' +
                    '\n' +
                    'Names\n' +
                    '=====\n' +
                    '{__none}boo:\n' +
                    '  namespace:\n' +
                    '    namespaceName:__none\n' +
                    '    preferredPrefix:\n' +
                    '  namespaceName:__none\n' +
                    '  localName:boo\n' +
                    '{__none}yar:\n' +
                    '  namespace:\n' +
                    '    namespaceName:__none\n' +
                    '    preferredPrefix:\n' +
                    '  namespaceName:__none\n' +
                    '  localName:yar\n' +
                    '{__none}baz:\n' +
                    '  namespace:\n' +
                    '    namespaceName:__none\n' +
                    '    preferredPrefix:\n' +
                    '  namespaceName:__none\n' +
                    '  localName:baz\n' +
                    '{http://www.ericwhite.com}boo:\n' +
                    '  namespace:\n' +
                    '    namespaceName:http://www.ericwhite.com\n' +
                    '    preferredPrefix:undefined\n' +
                    '  namespaceName:http://www.ericwhite.com\n' +
                    '  localName:boo\n' +
                    '{http://www.ericwhite.com}yar:\n' +
                    '  namespace:\n' +
                    '    namespaceName:http://www.ericwhite.com\n' +
                    '    preferredPrefix:undefined\n' +
                    '  namespaceName:http://www.ericwhite.com\n' +
                    '  localName:yar\n' +
                    '{http://www.ericwhite.com}baz:\n' +
                    '  namespace:\n' +
                    '    namespaceName:http://www.ericwhite.com\n' +
                    '    preferredPrefix:undefined\n' +
                    '  namespaceName:http://www.ericwhite.com\n' +
                    '  localName:baz\n' +
                    '{__none}diffOverload:\n' +
                    '  namespace:\n' +
                    '    namespaceName:__none\n' +
                    '    preferredPrefix:\n' +
                    '  namespaceName:\n' +
                    '  localName:diffOverload'
            },
            {
                testNum: 134,
                testFunc: function () {
                    return '';
                },
                output:
    ''
            },
            {
                testNum: 135,
                testFunc: function () {
                    var r = new XElement("root",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));
                    var r2 = r.descendants("d2").asXEnumerable().ancestorsAndSelf().where(function (a) { return a.name === new XName("d2") }).toArray();
                    var o = '';
                    for (var i = 0; i < r2.length; i++) {
                        o += r2[i].name + '\n';
                    }
                    return o;
                },
                output:
                    'd2\n' +
                    'd2\n'
            },
            {
                testNum: 136,
                testFunc: function () {
                    var r = new XElement("root",
                        new XElement("c1",
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d2", 7)));
                    var r2 = new XElement("root",
                        r.elements("c2").elements("d1"));
                    var r3 = new XElement("root",
                        r.elements().elements("d1"));
                    var o = '';
                    o += r2.toString(true);
                    o += '========================\n';
                    o += r3.toString(true);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <d1>3</d1>\n' +
                    '</root>\n' +
                    '========================\n' +
                    '<root>\n' +
                    '  <d1>1</d1>\n' +
                    '  <d1>3</d1>\n' +
                    '  <d1>4</d1>\n' +
                    '  <d1>6</d1>\n' +
                    '</root>'
            },
            {
                testNum: 137,
                testFunc: function () {
                    var r = new XElement("root",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d2", 7)));
                    var r2 = new XElement("root",
                        r.elements("c1").attributes("boo").firstOrDefault());
                    var r3 = new XElement("root",
                        r.elements().attributes());
                    var o = '';
                    o += r2.toString(true);
                    o += '========================\n';
                    o += r3.toString(true);
                    return o;
                },
                output:
                    '<root boo=\'101\'/>\n' +
                    '========================\n' +
                    '<root boo=\'101\'\n' +
                    '      yar=\'102\'/>'
            },
            {
                testNum: 138,
                testFunc: function () {
                    var r = new XElement("root",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d2", 7)));
                    var r2 = new XElement("root",
                        r.elements("c2").descendants("d2").firstOrDefault());
                    var r3 = new XElement("root",
                        r.elements().descendants());
                    var o = '';
                    o += r2.toString(true);
                    o += '========================\n';
                    o += r3.toString(true);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <d2>2</d2>\n' +
                    '</root>\n' +
                    '========================\n' +
                    '<root>\n' +
                    '  <d1>1</d1>\n' +
                    '  <d2>2</d2>\n' +
                    '  <d1>3</d1>\n' +
                    '  <d1>4</d1>\n' +
                    '  <d2>5</d2>\n' +
                    '  <d1>6</d1>\n' +
                    '  <d2>7</d2>\n' +
                    '</root>'
            },
            {
                testNum: 139,
                testFunc: function () {
                    var r = new XElement("root",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));
                    var r2 = r.descendants("d2").ancestorsAndSelf().toArray();
                    var o = '';
                    for (var i = 0; i < r2.length; i++) {
                        o += r2[i].name + '\n';
                    }
                    return o;
                },
                output:
                    'd2\n' +
                    'c2\n' +
                    'root\n' +
                    'd2\n' +
                    'c1\n' +
                    'root'
            },
            {
                testNum: 140,
                testFunc: function () {
                    var r = new XElement("root",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));
                    var r2 = r.descendants("d2").ancestorsAndSelf("c2").toArray();
                    var r3 = r.descendants("d2").ancestors("c2").toArray();
                    var r4 = r.descendants("d2").ancestors().toArray();
                    var o = '';
                    for (var i = 0; i < r2.length; i++) {
                        o += r2[i].name + '\n';
                    }
                    o += '=====\n';
                    for (var i = 0; i < r3.length; i++) {
                        o += r3[i].name + '\n';
                    }
                    o += '=====\n';
                    for (var i = 0; i < r4.length; i++) {
                        o += r4[i].name + '\n';
                    }
                    o += '=====\n';
                    return o;

                },
                output:
                    'c2\n' +
                    '=====\n' +
                    'c2\n' +
                    '=====\n' +
                    'c2\n' +
                    'root\n' +
                    'c1\n' +
                    'root\n' +
                    '====='
            },
            {
                testNum: 141,
                testFunc: function () {
                    var r = new XElement("d2",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));
                    var r2 = r.elements().descendantNodesAndSelf().toArray();
                    var r3 = r.elements().descendantsAndSelf("d2").toArray();
                    var r4 = r.elements().nodes().toArray();
                    var o = '';
                    for (var i = 0; i < r2.length; i++) {
                        o += r2[i].nodeType + (r2[i].nodeType === 'Element' ? (" " + r2[i].name) : "") + '\n';
                    }
                    o += '=====\n';
                    for (var i = 0; i < r3.length; i++) {
                        o += r3[i].name + '\n';
                    }
                    o += '=====\n';
                    for (var i = 0; i < r4.length; i++) {
                        o += r4[i].nodeType + (r4[i].nodeType === 'Element' ? (" " + r4[i].name) : "") + '\n';
                    }
                    return o;
                },
                output:
                    'Element c1\n' +
                    'Element d1\n' +
                    'Text\n' +
                    'Element c2\n' +
                    'Element d2\n' +
                    'Text\n' +
                    'Element d1\n' +
                    'Text\n' +
                    'Element c1\n' +
                    'Element d1\n' +
                    'Text\n' +
                    'Element d2\n' +
                    'Text\n' +
                    'Element c1\n' +
                    'Element d1\n' +
                    'Text\n' +
                    'Element c2\n' +
                    'Element d1\n' +
                    'Text\n' +
                    '=====\n' +
                    'd2\n' +
                    'd2\n' +
                    '=====\n' +
                    'Element d1\n' +
                    'Element d2\n' +
                    'Element d1\n' +
                    'Element d1\n' +
                    'Element d2\n' +
                    'Element d1\n' +
                    'Element d1'
            },
            {
                testNum: 142,
                testFunc: function () {
                    var r = new XElement("d2",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));

                    r.elements().elements().remove();
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<d2>\n' +
                    '  <c1 boo=\'101\'/>\n' +
                    '  <c2/>\n' +
                    '  <c1 yar=\'102\'/>\n' +
                    '  <c1/>\n' +
                    '  <c2/>\n' +
                    '</d2>'
            },
            {
                testNum: 143,
                testFunc: function () {
                    var r = new XElement("d2",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XComment("boo"),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));

                    r.elements().attributes().remove();
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<d2>\n' +
                    '  <c1>\n' +
                    '    <d1>1</d1>\n' +
                    '  </c1>\n' +
                    '  <c2>\n' +
                    '    <d2>2</d2>\n' +
                    '    <!--boo-->\n' +
                    '    <d1>3</d1>\n' +
                    '  </c2>\n' +
                    '  <c1>\n' +
                    '    <d1>4</d1>\n' +
                    '    <d2>5</d2>\n' +
                    '  </c1>\n' +
                    '  <c1>\n' +
                    '    <d1>6</d1>\n' +
                    '  </c1>\n' +
                    '  <c2>\n' +
                    '    <d1>7</d1>\n' +
                    '  </c2>\n' +
                    '</d2>'
            },
            {
                testNum: 144,
                testFunc: function () {
                    var r = new XElement("d2",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XComment("boo"),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));

                    r.elements().elements().remove();
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<d2>\n' +
                    '  <c1 boo=\'101\'/>\n' +
                    '  <c2/>\n' +
                    '  <c1 yar=\'102\'>\n' +
                    '    <!--boo-->\n' +
                    '  </c1>\n' +
                    '  <c1/>\n' +
                    '  <c2/>\n' +
                    '</d2>'
            },
            {
                testNum: 145,
                testFunc: function () {
                    var r = new XElement("d2",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XComment("boo"),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));

                    r.elements().nodes().remove();
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<d2>\n' +
                    '  <c1 boo=\'101\'/>\n' +
                    '  <c2/>\n' +
                    '  <c1 yar=\'102\'/>\n' +
                    '  <c1/>\n' +
                    '  <c2/>\n' +
                    '</d2>'
            },
            {
                testNum: 146,
                testFunc: function () {
                    var r = new XElement("d2",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XComment("boo"),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));

                    r.elements().elements("d1").remove();
                    var o = '';
                    o += r.toString(true);
                    return o;
                },
                output:
                    '<d2>\n' +
                    '  <c1 boo=\'101\'/>\n' +
                    '  <c2>\n' +
                    '    <d2>2</d2>\n' +
                    '  </c2>\n' +
                    '  <c1 yar=\'102\'>\n' +
                    '    <!--boo-->\n' +
                    '    <d2>5</d2>\n' +
                    '  </c1>\n' +
                    '  <c1/>\n' +
                    '  <c2/>\n' +
                    '</d2>'
            },
            {
                testNum: 147,
                testFunc: function () {
                    var wordDoc = XElement.parse(
                        "<root>" +
                        "<body>" +
                        "<p>" +
                        "<t>first para</t>" +
                        "</p>" +
                        "<p>" +
                        "<pPr>" +
                        "<style name='heading1'/>" +
                        "</pPr>" +
                        "<t>second para</t>" +
                        "</p>" +
                        "</body>" +
                        "</root>");

                    if (Object.defineProperties) {
                        var paraStyles = wordDoc.element("body")
                            .elements()
                            .select(function (p) {
                                var style = p.elements("pPr")
                                    .elements("style")
                                    .attributes("name")
                                    .select(function (a) { return a.value; })
                                    .firstOrDefault();
                                if (style === null)
                                    style = "normal";
                                return {
                                    Text: p.descendants("t")
                                        .select(function (t) { return t.value; })
                                        .aggregate("", function (s, i) { return s + i; }),
                                    Style: style
                                };
                            })
                            .toArray();
                    }
                    else {
                        var paraStyles = wordDoc.element("body")
                            .elements()
                            .select(function (p) {
                                var style = p.elements("pPr")
                                    .elements("style")
                                    .attributes("name")
                                    .select(function (a) { return a.value; })
                                    .firstOrDefault();
                                if (style === null)
                                    style = "normal";
                                return {
                                    Text: p.descendants("t")
                                        .select(function (t) { return t.getValue(); })
                                        .aggregate("", function (s, i) { return s + i; }),
                                    Style: style
                                };
                            })
                            .toArray();
                    }
                    var o = '';
                    o += wordDoc.toString(true);
                    o += paraStyles.length + '\n';
                    for (var i = 0; i < paraStyles.length; i++) {
                        o += paraStyles[i].Style + ":" + paraStyles[i].Text + '\n';
                    }
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <body>\n' +
                    '    <p>\n' +
                    '      <t>first para</t>\n' +
                    '    </p>\n' +
                    '    <p>\n' +
                    '      <pPr>\n' +
                    '        <style name=\'heading1\'/>\n' +
                    '      </pPr>\n' +
                    '      <t>second para</t>\n' +
                    '    </p>\n' +
                    '  </body>\n' +
                    '</root>\n' +
                    '2\n' +
                    'normal:first para\n' +
                    'heading1:second para'
            },
            {
                testNum: 148,
                testFunc: function () {
                    var r = new XElement("root",
                        new XElement("c1",
                            new XAttribute("boo", 101),
                            new XElement("d1", 1)),
                        new XElement("c2",
                            new XElement("d2", 2),
                            new XElement("d1", 3)),
                        new XElement("c1",
                            new XAttribute("yar", 102),
                            new XElement("d1", 4),
                            new XElement("d2", 5)),
                        new XElement("c1",
                            new XElement("d1", 6)),
                        new XElement("c2",
                            new XElement("d1", 7)));
                    var r2 = r.descendants("d2").ancestorsAndSelf().where(function (a) { return a.name === new XName("d2") }).toArray();
                    var o = '';
                    for (var i = 0; i < r2.length; i++) {
                        o += r2[i].name + '\n';
                    }
                    return o;
                },
                output:
                    'd2\n' +
                    'd2\n'
            },
            {
                testNum: 149,
                testFunc: function () {
                    var root = new XElement("root",
                        new XElement("c1", 1),
                        new XElement("c2", 1),
                        new XElement("c3", 1),
                        new XElement("c4", 1),
                        new XElement("c5", 1),
                        new XElement("c6", 1),
                        new XElement("c7", 1),
                        new XElement("c8", 1)
                    );
                    var o = '';
                    o += root.toString(true);
                    o += "==========================\n";
                    var c4 = root.element("c4");
                    var root2 = new XElement("root2",
                        c4.elementsBeforeSelfReverseDocumentOrder());
                    o += root2.toString(true);
                    o += checkParentage(root);
                    o += checkParentage(root2);
                    return o;
                },
                output:
                    '<root>\n' +
                    '  <c1>1</c1>\n' +
                    '  <c2>1</c2>\n' +
                    '  <c3>1</c3>\n' +
                    '  <c4>1</c4>\n' +
                    '  <c5>1</c5>\n' +
                    '  <c6>1</c6>\n' +
                    '  <c7>1</c7>\n' +
                    '  <c8>1</c8>\n' +
                    '</root>\n' +
                    '==========================\n' +
                    '<root2>\n' +
                    '  <c3>1</c3>\n' +
                    '  <c2>1</c2>\n' +
                    '  <c1>1</c1>\n' +
                    '</root2>'
            },
        // tests from 501 onwards test the various properties that are implemented only in EcmaScript5
            {
            testNum: 501,
            testFunc: function () {
                var ns1 = XNamespace.none;
                var e = XNamespace("http://www.ericwhite.com");

                var xn = e + "boo";
                var x = new XElement(xn,
                        new XAttribute(XNamespace.getXmlns() + "e", e.namespaceName),
                        "yar");
                var o = '';
                o += x.toString();
                o += checkParentage(x);
                return o;
            },
            output:
                    '<e:boo xmlns:e=\'http://www.ericwhite.com\'>yar</e:boo>'
        },
            {
                testNum: 502,
                testFunc: function () {
                    var o = '';
                    if (Object.defineProperties) {
                        o += XNamespace.xmlns + '\n';
                        o += XNamespace.xml + '\n';
                    }
                    else {
                        o += XNamespace.getXmlns() + '\n';
                        o += XNamespace.getXml() + '\n';
                    }
                    o += XNamespace.getXmlns() + '\n';
                    o += XNamespace.getXml() + '\n';
                    return o;
                },
                output:
                    '{http://www.w3.org/2000/xmlns/}\n' +
                    '{http://www.w3.org/XML/1998/namespace}\n' +
                    '{http://www.w3.org/2000/xmlns/}\n' +
                    '{http://www.w3.org/XML/1998/namespace}'
            },
            {
                testNum: 503,
                testFunc: function () {
                    var xdec = new XDeclaration("1.0", "UTF-8", "yes");
                    var root = new XDocument(xdec,
                    new XProcessingInstruction("mso-application", "progid=\"Word.Document\""),
                    new XElement("Root",
                        new XElement("Child", 1),
                        new XElement("Child", 2),
                        new XProcessingInstruction("boo", "yar"),
                        new XElement("Child", 3)));
                    var c3 = root.descendants("Child").where(function (f) {
                        if (Object.defineProperties)
                            return f.value === '3';
                        else
                            return f.getValue() === '3';
                    }).firstOrDefault();
                    if (Object.defineProperties)
                        var d3 = c3.document;
                    else
                        var d3 = c3.getDocument();
                    var xpi1 = root.descendantNodes().firstOrDefault(function (f) { return f.nodeType === 'ProcessingInstruction'; });
                    var o = '';
                    o += (d3 === root).toString() + '\n';
                    return o;
                },
                output:
                    'true'
            },
            {
                testNum: 504,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XElement("C1", 111),
                        new XElement("C2", 222),
                        new XText("hello"),
                        new XComment("this is comment"),
                        new XElement("C3", 111),
                        new XElement("C4", 222));
                    var c3 = root.element("C3");
                    var nbs = c3.nodesBeforeSelf().toArray();
                    var o = '';
                    for (var i = 0; i < nbs.length; i++) {
                        o += nbs[i].nodeType + '\n';
                    }
                    o += "====================\n";
                    var c2 = root.element("C2");
                    var nas = c2.nodesAfterSelf().toArray();
                    for (var i = 0; i < nbs.length; i++) {
                        o += nas[i].nodeType + '\n';
                    }
                    o += "====================\n";
                    if (Object.defineProperties) {
                        var nn = c2.nextNode;
                        o += nn.nodeType + '\n';
                        var pn = c2.previousNode;
                        o += pn.nodeType + '\n';
                        var c1 = root.element("C1");
                        pn = c1.previousNode;
                        o += (pn === null).toString() + '\n';
                        var c4 = root.element("C4");
                        nn = c4.nextNode;
                        o += (nn === null).toString() + '\n';
                    }
                    else {
                        var nn = c2.getNextNode();
                        o += nn.nodeType + '\n';
                        var pn = c2.getPreviousNode();
                        o += pn.nodeType + '\n';
                        var c1 = root.element("C1");
                        pn = c1.getPreviousNode();
                        o += (pn === null).toString() + '\n';
                        var c4 = root.element("C4");
                        nn = c4.getNextNode();
                        o += (nn === null).toString() + '\n';
                    }
                    o += checkParentage(root);
                    return o;
                },
                output:
                    'Element\n' +
                    'Element\n' +
                    'Text\n' +
                    'Comment\n' +
                    '====================\n' +
                    'Text\n' +
                    'Comment\n' +
                    'Element\n' +
                    'Element\n' +
                    '====================\n' +
                    'Text\n' +
                    'Element\n' +
                    'true\n' +
                    'true'
            },
            {
                testNum: 505,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XAttribute("Att1", 1),
                        new XAttribute("Att2", 2),
                        new XAttribute("Att3", 3),
                        new XAttribute("Att4", 4),
                        new XAttribute("Att5", 5),
                        new XAttribute("Att6", 6)
                    );
                    var att = root.attribute("Att3");
                    if (Object.defineProperties)
                        att.value = "new content";
                    else
                        att.setValue("new content");
                    var o = '';
                    o += checkParentage(root);
                    o += root.toString(true);
                    o += "====================\n";
                    if (Object.defineProperties) {
                        o += att.nextAttribute.toString() + '\n';
                        o += att.previousAttribute.toString() + '\n';
                        att = root.attribute("Att1");
                        o += (att.previousAttribute === null).toString() + '\n';
                        att = root.attribute("Att6");
                        o += (att.nextAttribute === null).toString() + '\n';
                    }
                    else {
                        o += att.getNextAttribute().toString() + '\n';
                        o += att.getPreviousAttribute().toString() + '\n';
                        att = root.attribute("Att1");
                        o += (att.getPreviousAttribute() === null).toString() + '\n';
                        att = root.attribute("Att6");
                        o += (att.getNextAttribute() === null).toString() + '\n';
                    }
                    return o;
                },
                output:
                    '<Root Att1=\'1\'\n' +
                    '      Att2=\'2\'\n' +
                    '      Att3=\'new content\'\n' +
                    '      Att4=\'4\'\n' +
                    '      Att5=\'5\'\n' +
                    '      Att6=\'6\'/>\n' +
                    '====================\n' +
                    'Att4=\'4\'\n' +
                    'Att2=\'2\'\n' +
                    'true\n' +
                    'true'
            },
            {
                testNum: 506,
                testFunc: function () {
                    var r = new XElement("root",
                        new XAttribute("a1", 1));
                    var v = r.attribute("a1").value;

                    var o = '';
                    o += v.toString() + '\n';
                    if (Object.defineProperties) {
                        r.attribute("a1").value = 123;
                        o += r.toString(true);
                        var a = r.attribute("a1");
                        if (a.previousAttribute === null)
                            o += "true\n";
                    }
                    else {
                        r.attribute("a1").value = 123;
                        o += r.toString(true);
                        a = r.attribute("a1");
                        if (a.getPreviousAttribute() === null)
                            o += "true\n";
                    }
                    return o;
                },
                output:
                    '1\n' +
                    '<root a1=\'123\'/>\n' +
                    'true'
            },
            {
                testNum: 507,
                testFunc: function () {
                    var root = new XElement("Root",
                        new XElement("C1", 111),
                        new XElement("C2", 200),
                        new XComment("this is going to be deleted"));
                    var o = '';
                    if (Object.defineProperties) {
                        o += root.firstNode.toString(true);
                        o += "==============\n";
                        o += root.lastNode.toString(true);
                        o += "==============\n";
                        root.removeNodes();
                        o += (root.firstNode === null).toString() + '\n';
                        o += (root.lastNode === null).toString() + '\n';
                    }
                    else {
                        o += root.getFirstNode().toString(true);
                        o += "==============\n";
                        o += root.getLastNode().toString(true);
                        o += "==============\n";
                        root.removeNodes();
                        o += (root.getFirstNode() === null).toString() + '\n';
                        o += (root.getLastNode() === null).toString() + '\n';
                    }
                    o += checkParentage(root);
                    return o;
                },
                output:
                    '<C1>111</C1>\n' +
                    '==============\n' +
                    '<!--this is going to be deleted-->\n' +
                    '==============\n' +
                    'true\n' +
                    'true'
            },
            {
                testNum: 508,
                testFunc: function () {
                    var r = new XDocument(
                        new XElement("r",
                            new XElement("c",
                                new XElement("gc"))));
                    if (Object.defineProperties)
                        var root = r.root;
                    else
                        var root = r.getRoot();
                    var gc = r.descendants("gc").firstOrDefault();
                    var anc = gc.ancestorsAndSelf("c").firstOrDefault();
                    var anc2 = gc.ancestorsAndSelf("gc").firstOrDefault();
                    var o = '';
                    o += root.name.toString() + '\n';
                    o += anc.toString(true);
                    o += anc2.toString(true);
                    return o;
                },
                output:
                    'r\n' +
                    '<c>\n' +
                    '  <gc/>\n' +
                    '</c>\n' +
                    '<gc/>'
            },
            {
                testNum: 509,
                testFunc: function () {
                    var root = new XElement("root",
                        new XAttribute("a1", 1),
                        new XAttribute("a2", 2),
                        new XAttribute("a3", 3),
                        new XAttribute("a4", 4),
                        new XAttribute("a5", 5));
                    var o = '';
                    if (Object.defineProperties) {
                        o += root.firstAttribute.toString() + '\n';
                        o += root.lastAttribute.toString() + '\n';
                        var root2 = new XElement("root");
                        if (root2.lastAttribute === null)
                            o += "lastAttribute on empty att list works\n";
                    }
                    else {
                        o += root.getFirstAttribute().toString() + '\n';
                        o += root.getLastAttribute().toString() + '\n';
                        var root2 = new XElement("root");
                        if (root2.getLastAttribute() === null)
                            o += "lastAttribute on empty att list works\n";
                    }
                    o += checkParentage(root);
                    return o;
                },
                output:
                    'a1=\'1\'\n' +
                    'a5=\'5\'\n' +
                    'lastAttribute on empty att list works'
            },
            {
                testNum: 510,
                testFunc: function () {
                    var r1 = new XElement("root",
                        new XAttribute("a1", 1),
                        new XAttribute("a2", 2),
                        new XAttribute("a3", 3),
                        new XAttribute("a4", 4),
                        new XAttribute("a5", 5));
                    var r2 = new XElement("root",
                        new XElement("a1", 1),
                        new XElement("a2", 2),
                        new XElement("a3", 3),
                        new XElement("a4", 4),
                        new XElement("a5", 5));
                    var o = '';
                    if (Object.defineProperties) {
                        o += r1.hasAttributes.toString() + '\n';
                        o += r1.hasElements.toString() + '\n';
                        o += r2.hasAttributes.toString() + '\n';
                        o += r2.hasElements.toString() + '\n';
                    }
                    else {
                        o += r1.getHasAttributes().toString() + '\n';
                        o += r1.getHasElements().toString() + '\n';
                        o += r2.getHasAttributes().toString() + '\n';
                        o += r2.getHasElements().toString() + '\n';
                    }
                    o += checkParentage(r1);
                    o += checkParentage(r2);
                    return o;
                },
                output:
                    'true\n' +
                    'false\n' +
                    'false\n' +
                    'true'
            },
            {
                testNum: 511,
                testFunc: function () {
                    if (Object.defineProperties) {
                        var el1 = new XElement("Root");
                        var o = '';
                        o += el1.toString(true);
                        o += el1.isEmpty.toString() + '\n';
                        o += '\n';
                        o += checkParentage(el1);
                        var el2 = new XElement("Root", "content");
                        o += el2.toString(true);
                        o += el2.isEmpty.toString() + '\n';
                        o += '\n';
                        o += checkParentage(el2);
                        var el3 = new XElement("Root", "");
                        o += el3.toString(true);
                        o += el3.isEmpty.toString() + '\n';
                        o += '\n';
                        o += checkParentage(el3);
                        el3.replaceAll(null);
                        o += el3.toString(true);
                        o += el3.isEmpty.toString() + '\n';
                    }
                    else {
                        var el1 = new XElement("Root");
                        o = '';
                        o += el1.toString(true);
                        o += el1.getIsEmpty().toString() + '\n';
                        o += '\n';
                        o += checkParentage(el1);
                        var el2 = new XElement("Root", "content");
                        o += el2.toString(true);
                        o += el2.getIsEmpty().toString() + '\n';
                        o += '\n';
                        o += checkParentage(el2);
                        var el3 = new XElement("Root", "");
                        o += el3.toString(true);
                        o += el3.getIsEmpty().toString() + '\n';
                        o += '\n';
                        o += checkParentage(el3);
                        el3.replaceAll(null);
                        o += el3.toString(true);
                        o += el3.getIsEmpty().toString() + '\n';
                    }
                    o += checkParentage(el3);
                    return o;
                },
                output:
                    '<Root/>\n' +
                    'true\n' +
                    '\n' +
                    '<Root>content</Root>\n' +
                    'false\n' +
                    '\n' +
                    '<Root></Root>\n' +
                    'false\n' +
                    '\n' +
                    '<Root/>\n' +
                    'true'
            },
            {
                testNum: 601,
                testFunc: function () {
                    var o = '';

                    var el1 = new XElement("root",
                        new XText("foo"),
                        new XEntity("nbsp"),
                        new XText("bar"));
                    o += el1.toString(true);
                    o += checkParentage(el1);
                    return o;
                },
                output:
                    '<root>foo&nbsp;bar</root>\n'
            },
            {
                testNum: 602,
                testFunc: function () {
                    var o = '';

                    var el1 = new XElement("root",
                        new XText("foo"),
                        new XEntity("bull"),
                        new XText("bar"));
                    o += el1.toString(true);
                    o += checkParentage(el1);
                    return o;
                },
                output:
                    '<root>foo&bull;bar</root>\n'
            },
            {
                testNum: 603,
                testFunc: function () {
                    var o = '';

                    var namespaces = [
                        new XNamespace("http://www.ericwhite.com/one", "e1"),
                        new XNamespace("http://www.ericwhite.com/two", "e2"),
                        new XNamespace("http://www.ericwhite.com/three", "e3"),
                        new XNamespace("http://www.ericwhite.com/four", "e4"),
                        new XNamespace("http://www.ericwhite.com/five", "e5"),
                        new XNamespace("http://www.ericwhite.com/six", "e6"),
                        new XNamespace("http://www.ericwhite.com/seven", "e7"),
                        new XNamespace("http://www.ericwhite.com/eight", "e8"),
                        new XNamespace("http://www.ericwhite.com/nine", "e9"),
                        new XNamespace("http://www.ericwhite.com/ten", "e10"),
                    ];

                    var names = [
                        "aaa",
                        "bbb",
                        "ccc",
                        "ddd",
                        "eee",
                        "fff",
                        "ggg",
                        "hhh",
                        "iii",
                        "jjj",
                        "kkk",
                        "lll",
                        "mmm",
                        "nnn",
                        "ooo",
                        "ppp",
                    ];

                    var root = new XElement("root",
                        Enumerable.from(namespaces).select(function (nsn) { return new XAttribute(XNamespace.xmlns + nsn.preferredPrefix, nsn.namespaceName); }));
                    for (var i = 0; i < 4000; i++) {
                        var n = Math.floor(Math.random() * namespaces.length);
                        var ns = namespaces[n];
                        var l = Math.floor(Math.random() * names.length);
                        var ln = names[l];
                        var no = new XName(ns, ln);
                        var e = new XElement(no, "0");
                        root.add(e);
                    }
                    bucketTimer.bucket("603a");
                    var s = root.toString(false);
                    //bucketTimer.bucket("603b");
                    //var t = XElement.parse(s);
                    //var cn = t.descendantNodes().count();
                    //o = cn.toString();
                    o = 'true';
                    return o;
                },
                output:
                    'true'
            },
            {
                testNum: 604,
                testFunc: function () {
                    var o = '';

                    var namespaces = [
                        new XNamespace("http://www.ericwhite.com/one", "e1"),
                        new XNamespace("http://www.ericwhite.com/two", "e2"),
                        new XNamespace("http://www.ericwhite.com/three", "e3"),
                        new XNamespace("http://www.ericwhite.com/four", "e4"),
                        new XNamespace("http://www.ericwhite.com/five", "e5"),
                        new XNamespace("http://www.ericwhite.com/six", "e6"),
                        new XNamespace("http://www.ericwhite.com/seven", "e7"),
                        new XNamespace("http://www.ericwhite.com/eight", "e8"),
                        new XNamespace("http://www.ericwhite.com/nine", "e9"),
                        new XNamespace("http://www.ericwhite.com/ten", "e10"),
                    ];

                    var names = [
                        "aaa",
                        "bbb",
                        "ccc",
                        "ddd",
                        "eee",
                        "fff",
                        "ggg",
                        "hhh",
                        "iii",
                        "jjj",
                        "kkk",
                        "lll",
                        "mmm",
                        "nnn",
                        "ooo",
                        "ppp",
                    ];

                    var numberElementsPerLevel = [6, 6, 6, 6, 6, 6];
                    var numberElementsWithChildElementsPerLevel = [6, 4, 3, 3, 3, 3];
                    var numberAttributesPerElement = [1, 3, 2, 3, 4, 1];

                    var addLevelToTree = function (element, levelNumber) {
                        for (var i = 0; i < numberElementsPerLevel[levelNumber]; i++) {
                            var n = Math.floor(Math.random() * namespaces.length);
                            var ns = namespaces[n];
                            var l = Math.floor(Math.random() * names.length);
                            var ln = names[l];
                            var no = new XName(ns, ln);
                            if (i < numberElementsWithChildElementsPerLevel[levelNumber]) {
                                var e = new XElement(no);
                                if (levelNumber < numberElementsPerLevel.length - 1) {
                                    addLevelToTree(e, levelNumber + 1);
                                }
                            }
                            else {
                                var e = new XElement(no, "0");
                                for (var j = 0; j < numberAttributesPerElement[levelNumber]; ++j) {
                                    var ns = namespaces[j];
                                    var ln = names[j];
                                    var no = new XName(ns, ln);
                                    var a = new XAttribute(no, "1");
                                    e.add(a);
                                }
                            }
                            element.add(e);
                        }
                    }

                    var root = new XElement("root",
                        Enumerable.from(namespaces).select(function (nsn) { return new XAttribute(XNamespace.xmlns + nsn.preferredPrefix, nsn.namespaceName); }));

                    addLevelToTree(root, 0);

                    bucketTimer.bucket("604a");
                    var s = root.toString(false);
                    //bucketTimer.bucket("604b");
                    //var t = XElement.parse(s);
                    //var same = root.deepEquals(t);
                    //o += same.toString() + '\n';
                    o = 'true';
                    return o;
                },
                output:
                    'true'
            },
            {
                testNum: 605,
                testFunc: function () {
                    var o = '';

                    var e1 = new XNamespace("http://www.ericwhite.com/one", "e1");
                    var e2 = new XNamespace("http://www.ericwhite.com/two", "e2");
                    var e3 = new XNamespace("http://www.ericwhite.com/three", "e3");
                    var e4 = new XNamespace("http://www.ericwhite.com/four", "e4");
                    var e5 = new XNamespace("http://www.ericwhite.com/five", "e5");
                    var e6 = new XNamespace("http://www.ericwhite.com/six", "e6");
                    var e7 = new XNamespace("http://www.ericwhite.com/seven", "e7");
                    var e8 = new XNamespace("http://www.ericwhite.com/eight", "e8");
                    var e9 = new XNamespace("http://www.ericwhite.com/nine", "e9");
                    var e10 = new XNamespace("http://www.ericwhite.com/ten", "e10");

                    var aaa = new XName(e1, "aaa");
                    var bbb = new XName(e1, "bbb");
                    var ccc = new XName(e1, "ccc");
                    var ddd = new XName(e2, "ddd");
                    var eee = new XName(e2, "eee");
                    var fff = new XName(e2, "fff");
                    var ggg = new XName(e3, "ggg");
                    var hhh = new XName(e3, "hhh");
                    var iii = new XName(e3, "iii");
                    var jjj = new XName(e4, "jjj");
                    var kkk = new XName(e4, "kkk");
                    var lll = new XName(e4, "lll");
                    var mmm = new XName(e5, "mmm");
                    var nnn = new XName(e5, "nnn");
                    var ooo = new XName(e5, "ooo");
                    var ppp = new XName(e6, "ppp");
                    var qqq = new XName(e6, "qqq");
                    var rrr = new XName(e6, "rrr");
                    var sss = new XName(e7, "sss");
                    var ttt = new XName(e7, "ttt");
                    var uuu = new XName(e8, "uuu");
                    var vvv = new XName(e9, "vvv");
                    var www = new XName(e9, "www");
                    var xxx = new XName(e9, "xxx");
                    var yyy = new XName(e10, "yyy");
                    var zzz = new XName(e10, "zzz");

                    var az = new XAttribute(XNamespace.xmlns + "e1", e1.namespaceName);

                    var root = new XElement(aaa,
                        new XAttribute(XNamespace.xmlns + "e1", e1.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e2", e2.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e3", e3.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e4", e4.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e5", e5.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e6", e6.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e7", e7.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e8", e8.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e9", e9.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e10", e10.namespaceName),
                        new XElement(bbb,
                            new XElement(ccc, 1),
                            new XElement(ccc,
                                new XElement(ddd, 100),
                                new XElement(ddd, 200),
                                new XElement(ddd, 300)),
                            new XElement(eee,
                                new XElement(fff, 111),
                                new XElement(ggg, 111),
                                new XElement(hhh, 111)),
                            new XElement(iii,
                                new XElement(jjj, "a"),
                                new XElement(kkk, "a"),
                                new XElement(lll, "a")),
                            new XElement(mmm,
                                new XAttribute(XNamespace.xmlns + "zzz5", e5.namespaceName),
                                new XElement(nnn, "a"),
                                new XElement(ooo, "a"),
                                new XElement(ppp, "a")),
                            new XElement(qqq,
                                new XElement(rrr, "a"),
                                new XElement(sss, "a"),
                                new XElement(ttt, "a")),
                            new XElement(uuu,
                                new XElement(vvv, "a"),
                                new XElement(www, "a"),
                                new XElement(xxx, "a"),
                                new XElement(yyy, "a"),
                                new XElement(zzz, "a"))));
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<e1:aaa xmlns:e1=\'http://www.ericwhite.com/one\'\n' +
                    '        xmlns:e10=\'http://www.ericwhite.com/ten\'\n' +
                    '        xmlns:e2=\'http://www.ericwhite.com/two\'\n' +
                    '        xmlns:e3=\'http://www.ericwhite.com/three\'\n' +
                    '        xmlns:e4=\'http://www.ericwhite.com/four\'\n' +
                    '        xmlns:e5=\'http://www.ericwhite.com/five\'\n' +
                    '        xmlns:e6=\'http://www.ericwhite.com/six\'\n' +
                    '        xmlns:e7=\'http://www.ericwhite.com/seven\'\n' +
                    '        xmlns:e8=\'http://www.ericwhite.com/eight\'\n' +
                    '        xmlns:e9=\'http://www.ericwhite.com/nine\'>\n' +
                    '  <e1:bbb>\n' +
                    '    <e1:ccc>1</e1:ccc>\n' +
                    '    <e1:ccc>\n' +
                    '      <e2:ddd>100</e2:ddd>\n' +
                    '      <e2:ddd>200</e2:ddd>\n' +
                    '      <e2:ddd>300</e2:ddd>\n' +
                    '    </e1:ccc>\n' +
                    '    <e2:eee>\n' +
                    '      <e2:fff>111</e2:fff>\n' +
                    '      <e3:ggg>111</e3:ggg>\n' +
                    '      <e3:hhh>111</e3:hhh>\n' +
                    '    </e2:eee>\n' +
                    '    <e3:iii>\n' +
                    '      <e4:jjj>a</e4:jjj>\n' +
                    '      <e4:kkk>a</e4:kkk>\n' +
                    '      <e4:lll>a</e4:lll>\n' +
                    '    </e3:iii>\n' +
                    '    <zzz5:mmm xmlns:zzz5=\'http://www.ericwhite.com/five\'>\n' +
                    '      <zzz5:nnn>a</zzz5:nnn>\n' +
                    '      <zzz5:ooo>a</zzz5:ooo>\n' +
                    '      <e6:ppp>a</e6:ppp>\n' +
                    '    </zzz5:mmm>\n' +
                    '    <e6:qqq>\n' +
                    '      <e6:rrr>a</e6:rrr>\n' +
                    '      <e7:sss>a</e7:sss>\n' +
                    '      <e7:ttt>a</e7:ttt>\n' +
                    '    </e6:qqq>\n' +
                    '    <e8:uuu>\n' +
                    '      <e9:vvv>a</e9:vvv>\n' +
                    '      <e9:www>a</e9:www>\n' +
                    '      <e9:xxx>a</e9:xxx>\n' +
                    '      <e10:yyy>a</e10:yyy>\n' +
                    '      <e10:zzz>a</e10:zzz>\n' +
                    '    </e8:uuu>\n' +
                    '  </e1:bbb>\n' +
                    '</e1:aaa>'
            },
            {
                testNum: 606,
                testFunc: function () {
                    var o = '';

                    var e1 = new XNamespace("http://www.ericwhite.com/one", "e1");
                    var e2 = new XNamespace("http://www.ericwhite.com/two", "e2");
                    var e3 = new XNamespace("http://www.ericwhite.com/three", "e3");
                    var e4 = new XNamespace("http://www.ericwhite.com/four", "e4");
                    var e5 = new XNamespace("http://www.ericwhite.com/five", "e5");
                    var e6 = new XNamespace("http://www.ericwhite.com/six", "e6");
                    var e7 = new XNamespace("http://www.ericwhite.com/seven", "e7");
                    var e8 = new XNamespace("http://www.ericwhite.com/eight", "e8");
                    var e9 = new XNamespace("http://www.ericwhite.com/nine", "e9");
                    var e10 = new XNamespace("http://www.ericwhite.com/ten", "e10");

                    var aaa = new XName(e1, "aaa");
                    var bbb = new XName(e1, "bbb");
                    var ccc = new XName(e1, "ccc");
                    var ddd = new XName(e2, "ddd");
                    var eee = new XName(e2, "eee");
                    var fff = new XName(e2, "fff");
                    var ggg = new XName(e3, "ggg");
                    var hhh = new XName(e3, "hhh");
                    var iii = new XName(e3, "iii");
                    var jjj = new XName(e4, "jjj");
                    var kkk = new XName(e4, "kkk");
                    var lll = new XName(e4, "lll");
                    var mmm = new XName(e5, "mmm");
                    var nnn = new XName(e5, "nnn");
                    var ooo = new XName(e5, "ooo");
                    var ppp = new XName(e6, "ppp");
                    var qqq = new XName(e6, "qqq");
                    var rrr = new XName(e6, "rrr");
                    var sss = new XName(e7, "sss");
                    var ttt = new XName(e7, "ttt");
                    var uuu = new XName(e8, "uuu");
                    var vvv = new XName(e9, "vvv");
                    var www = new XName(e9, "www");
                    var xxx = new XName(e9, "xxx");
                    var yyy = new XName(e10, "yyy");
                    var zzz = new XName(e10, "zzz");

                    var az = new XAttribute(XNamespace.xmlns + "e1", e1.namespaceName);

                    var root = new XElement(aaa,
                        new XAttribute("xmlns", e1.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e2", e2.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e3", e3.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e4", e4.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e5", e5.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e6", e6.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e7", e7.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e8", e8.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e9", e9.namespaceName),
                        new XAttribute(XNamespace.xmlns + "e10", e10.namespaceName),
                        new XElement(bbb,
                            new XElement(ccc, 1),
                            new XElement(ccc,
                                new XElement(ddd, 100),
                                new XElement(ddd, 200),
                                new XElement(ddd, 300)),
                            new XElement(eee,
                                new XElement(fff, 111),
                                new XElement(ggg, 111),
                                new XElement(hhh, 111)),
                            new XElement(iii,
                                new XElement(jjj, "a"),
                                new XElement(kkk, "a"),
                                new XElement(lll, "a")),
                            new XElement(mmm,
                                new XAttribute("xmlns", e5.namespaceName),
                                new XElement(nnn, "a"),
                                new XElement(ooo, "a"),
                                new XElement(ppp, "a")),
                            new XElement(qqq,
                                new XElement(rrr, "a"),
                                new XElement(sss, "a"),
                                new XElement(ttt, "a")),
                            new XElement(uuu,
                                new XElement(vvv, "a"),
                                new XElement(www, "a"),
                                new XElement(xxx, "a"),
                                new XElement(yyy, "a"),
                                new XElement(zzz, "a"))));
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<aaa xmlns:e10=\'http://www.ericwhite.com/ten\'\n' +
                    '     xmlns:e2=\'http://www.ericwhite.com/two\'\n' +
                    '     xmlns:e3=\'http://www.ericwhite.com/three\'\n' +
                    '     xmlns:e4=\'http://www.ericwhite.com/four\'\n' +
                    '     xmlns:e5=\'http://www.ericwhite.com/five\'\n' +
                    '     xmlns:e6=\'http://www.ericwhite.com/six\'\n' +
                    '     xmlns:e7=\'http://www.ericwhite.com/seven\'\n' +
                    '     xmlns:e8=\'http://www.ericwhite.com/eight\'\n' +
                    '     xmlns:e9=\'http://www.ericwhite.com/nine\'\n' +
                    '     xmlns=\'http://www.ericwhite.com/one\'>\n' +
                    '  <bbb>\n' +
                    '    <ccc>1</ccc>\n' +
                    '    <ccc>\n' +
                    '      <e2:ddd>100</e2:ddd>\n' +
                    '      <e2:ddd>200</e2:ddd>\n' +
                    '      <e2:ddd>300</e2:ddd>\n' +
                    '    </ccc>\n' +
                    '    <e2:eee>\n' +
                    '      <e2:fff>111</e2:fff>\n' +
                    '      <e3:ggg>111</e3:ggg>\n' +
                    '      <e3:hhh>111</e3:hhh>\n' +
                    '    </e2:eee>\n' +
                    '    <e3:iii>\n' +
                    '      <e4:jjj>a</e4:jjj>\n' +
                    '      <e4:kkk>a</e4:kkk>\n' +
                    '      <e4:lll>a</e4:lll>\n' +
                    '    </e3:iii>\n' +
                    '    <mmm xmlns=\'http://www.ericwhite.com/five\'>\n' +
                    '      <nnn>a</nnn>\n' +
                    '      <ooo>a</ooo>\n' +
                    '      <e6:ppp>a</e6:ppp>\n' +
                    '    </mmm>\n' +
                    '    <e6:qqq>\n' +
                    '      <e6:rrr>a</e6:rrr>\n' +
                    '      <e7:sss>a</e7:sss>\n' +
                    '      <e7:ttt>a</e7:ttt>\n' +
                    '    </e6:qqq>\n' +
                    '    <e8:uuu>\n' +
                    '      <e9:vvv>a</e9:vvv>\n' +
                    '      <e9:www>a</e9:www>\n' +
                    '      <e9:xxx>a</e9:xxx>\n' +
                    '      <e10:yyy>a</e10:yyy>\n' +
                    '      <e10:zzz>a</e10:zzz>\n' +
                    '    </e8:uuu>\n' +
                    '  </bbb>\n' +
                    '</aaa>'
            },
            {
                testNum: 607,
                testFunc: function () {
                    var o = '';

                    var e1 = new XNamespace("http://www.ericwhite.com/one", "e1");
                    var e2 = new XNamespace("http://www.ericwhite.com/two", "e2");
                    var e3 = new XNamespace("http://www.ericwhite.com/three", "e3");

                    var root = new XElement(e1 + "aaa",
                        new XAttribute("xmlns", e1.namespaceName),
                        new XElement(e2 + "bbb",
                            new XAttribute("xmlns", e2.namespaceName),
                            new XElement(e3 + "ccc",
                                new XAttribute("xmlns", e3.namespaceName))));
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<aaa xmlns=\'http://www.ericwhite.com/one\'>\n' +
                    '  <bbb xmlns=\'http://www.ericwhite.com/two\'>\n' +
                    '    <ccc xmlns=\'http://www.ericwhite.com/three\'/>\n' +
                    '  </bbb>\n' +
                    '</aaa>'
            },
            {
                testNum: 608,
                testFunc: function () {
                    var o = '';

                    var xml =
                        '<aaa xmlns=\'http://www.ericwhite.com/one\'>' +
                          '<bbb xmlns=\'http://www.ericwhite.com/two\'>' +
                            '<ccc xmlns=\'http://www.ericwhite.com/three\'/>' +
                          '</bbb>' +
                        '</aaa>';
                    var root = XElement.parse(xml);
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<aaa xmlns=\'http://www.ericwhite.com/one\'>\n' +
                    '  <bbb xmlns=\'http://www.ericwhite.com/two\'>\n' +
                    '    <ccc xmlns=\'http://www.ericwhite.com/three\'/>\n' +
                    '  </bbb>\n' +
                    '</aaa>'
            },
            {
                testNum: 609,
                testFunc: function () {
                    var o = '';

                    var xml =
                        '<table xmlns="http://www.w3.org/TR/html4/">' +
                          '<tr>' +
                            '<td xmlns="">Apples</td>' +
                            '<td>Bananas</td>' +
                          '</tr>' +
                        '</table>';
                    var root = XElement.parse(xml);
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<table xmlns=\'http://www.w3.org/TR/html4/\'>\n' +
                    '  <tr>\n' +
                    '    <td xmlns=\'\'>Apples</td>\n' +
                    '    <td>Bananas</td>\n' +
                    '  </tr>\n' +
                    '</table>'
            },
            {
                testNum: 610,
                testFunc: function () {
                    var o = '';

                    var xml = '<table xmlns="http://www.w3.org/TR/html4/">' +
                        '<tr>' +
                        '<w:td xmlns:w="http://www.ericwhite.com/">Apples</w:td>' +
                        '<td>Bananas</td>' +
                        '</tr>' +
                        '</table>';
                    var root = XElement.parse(xml);
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<table xmlns=\'http://www.w3.org/TR/html4/\'>\n' +
                    '  <tr>\n' +
                    '    <w:td xmlns:w=\'http://www.ericwhite.com/\'>Apples</w:td>\n' +
                    '    <td>Bananas</td>\n' +
                    '  </tr>\n' +
                    '</table>'
            },
            {
                testNum: 611,
                testFunc: function () {
                    var o = '';

                    var ns1 = new XNamespace("http://www.ericwhite.com/one");
                    var ns2 = new XNamespace("http://www.ericwhite.com/two");

                    var root = new XElement(ns1 + "a",
                        new XElement(ns2 + "b",
                            new XElement(ns1 + "c", "abc")));
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<p0:a xmlns:p0=\'http://www.ericwhite.com/one\'>\n' +
                    '  <p1:b xmlns:p1=\'http://www.ericwhite.com/two\'>\n' +
                    '    <p0:c>abc</p0:c>\n' +
                    '  </p1:b>\n' +
                    '</p0:a>'
            },
            {
                testNum: 612,
                testFunc: function () {
                    var o = '';

                    var ns1 = new XNamespace("http://www.ericwhite.com/one");
                    var ns2 = new XNamespace("http://www.ericwhite.com/two");
                    var ns3 = new XNamespace("http://www.ericwhite.com/three");

                    var root = new XElement(ns1 + "a",
                        new XElement(ns3 + "a1", "z",
                            new XAttribute(XNamespace.getXmlns() + "p0", ns3.namespaceName)),
                        new XElement(ns2 + "b",
                            new XElement(ns1 + "c", "abc")));
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<p0:a xmlns:p0=\'http://www.ericwhite.com/one\'>\n' +
                    '  <p0:a1 xmlns:p0=\'http://www.ericwhite.com/three\'>z</p0:a1>\n' +
                    '  <p1:b xmlns:p1=\'http://www.ericwhite.com/two\'>\n' +
                    '    <p0:c>abc</p0:c>\n' +
                    '  </p1:b>\n' +
                    '</p0:a>'
            },
            {
                testNum: 613,
                testFunc: function () {
                    var o = '';

                    var ns1 = new XNamespace("http://www.ericwhite.com/one");
                    var ns2 = new XNamespace("http://www.ericwhite.com/two");
                    var ns3 = new XNamespace("http://www.ericwhite.com/three");

                    var root = new XElement(ns1 + "a",
                        new XAttribute(XNamespace.getXmlns() + "p0", ns1.namespaceName),
                        new XElement(ns2 + "b",
                            new XElement(ns3 + "c", "abc")));
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<p0:a xmlns:p0=\'http://www.ericwhite.com/one\'>\n' +
                    '  <p1:b xmlns:p1=\'http://www.ericwhite.com/two\'>\n' +
                    '    <p2:c xmlns:p2=\'http://www.ericwhite.com/three\'>abc</p2:c>\n' +
                    '  </p1:b>\n' +
                    '</p0:a>'
            },
            {
                testNum: 614,
                testFunc: function () {
                    var o = '';

                    var ns1 = new XNamespace("http://www.ericwhite.com/one");
                    var ns2 = new XNamespace("http://www.ericwhite.com/two");
                    var ns3 = new XNamespace("http://www.ericwhite.com/three");

                    var root = new XElement(ns1 + "a",
                        new XAttribute(XNamespace.getXmlns() + "p1", ns1.namespaceName),
                        new XElement(ns2 + "b",
                            new XElement(ns3 + "c", "abc")));
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<p1:a xmlns:p1=\'http://www.ericwhite.com/one\'>\n' +
                    '  <p0:b xmlns:p0=\'http://www.ericwhite.com/two\'>\n' +
                    '    <p2:c xmlns:p2=\'http://www.ericwhite.com/three\'>abc</p2:c>\n' +
                    '  </p0:b>\n' +
                    '</p1:a>'
            },
            {
                testNum: 615,
                testFunc: function () {
                    var o = '';

                    var ns1 = new XNamespace("http://www.ericwhite.com/one");
                    var ns2 = new XNamespace("http://www.ericwhite.com/two");
                    var ns3 = new XNamespace("http://www.ericwhite.com/three");

                    var root = new XElement(ns1 + "a",
                        new XAttribute("xmlns", ns1.namespaceName),
                        new XElement("b",
                            new XElement("c", "abc")));
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<a xmlns=\'http://www.ericwhite.com/one\'>\n' +
                    '  <b xmlns=\'\'>\n' +
                    '    <c>abc</c>\n' +
                    '  </b>\n' +
                    '</a>'
            },
            {
                testNum: 616,
                testFunc: function () {
                    var o = '';

                    var ns1 = new XNamespace("http://www.ericwhite.com/one");
                    var ns2 = new XNamespace("http://www.ericwhite.com/two");
                    var ns3 = new XNamespace("http://www.ericwhite.com/three");

                    var root = new XElement(ns1 + "a",
                        new XAttribute("xmlns", ns1.namespaceName),
                        new XElement(ns2 + "b",
                            new XElement(ns1 + "c", "abc"),
                            new XElement(ns2 + "d", "def")));
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<a xmlns=\'http://www.ericwhite.com/one\'>\n' +
                    '  <p0:b xmlns:p0=\'http://www.ericwhite.com/two\'>\n' +
                    '    <c>abc</c>\n' +
                    '    <p0:d>def</p0:d>\n' +
                    '  </p0:b>\n' +
                    '</a>'
            },
            {
                testNum: 617,
                testFunc: function () {
                    var o = '';

                    var ns1 = new XNamespace("http://www.ericwhite.com/one");
                    var ns2 = new XNamespace("http://www.ericwhite.com/two");
                    var ns3 = new XNamespace("http://www.ericwhite.com/three");

                    var root = new XElement(ns1 + "a",
                        new XAttribute("xmlns", ns1.namespaceName),
                        new XElement(ns2 + "b",
                            new XAttribute(XNamespace.getXmlns() + "p0", ns2.namespaceName),
                            new XElement(ns1 + "c", "abc"),
                            new XElement(ns2 + "d", "def"),
                            new XElement(ns3 + "e", "ghi")));
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<a xmlns=\'http://www.ericwhite.com/one\'>\n' +
                    '  <p0:b xmlns:p0=\'http://www.ericwhite.com/two\'>\n' +
                    '    <c>abc</c>\n' +
                    '    <p0:d>def</p0:d>\n' +
                    '    <p1:e xmlns:p1=\'http://www.ericwhite.com/three\'>ghi</p1:e>\n' +
                    '  </p0:b>\n' +
                    '</a>'
            },
            {
                testNum: 618,
                testFunc: function () {
                    var o = '';

                    var ns1 = new XNamespace("http://www.ericwhite.com/one");
                    var ns2 = new XNamespace("http://www.ericwhite.com/two");
                    var ns3 = new XNamespace("http://www.ericwhite.com/three");

                    // this ends up with a superfluous p0 namespace, but having the code define 
                    // a p0 namespace is rare, so no need to optimize this.
                    var root = new XElement(ns1 + "a",
                        new XAttribute("xmlns", ns1.namespaceName),
                        new XAttribute(ns2 + "d", "def"),
                        new XElement(ns2 + "b",
                            new XAttribute(XNamespace.getXmlns() + "p0", ns2.namespaceName),
                            new XAttribute(ns1 + "c", "abc"),
                            new XAttribute(ns2 + "d", "def"),
                            new XAttribute(ns3 + "e", "ghi")));
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<a p0:d=\'def\'\n' +
                    '   xmlns:p0=\'http://www.ericwhite.com/two\'\n' +
                    '   xmlns=\'http://www.ericwhite.com/one\'>\n' +
                    '  <p0:b p1:c=\'abc\'\n' +
                    '        p2:e=\'ghi\'\n' +
                    '        p0:d=\'def\'\n' +
                    '        xmlns:p0=\'http://www.ericwhite.com/two\'\n' +
                    '        xmlns:p1=\'http://www.ericwhite.com/one\'\n' +
                    '        xmlns:p2=\'http://www.ericwhite.com/three\'/>\n' +
                    '</a>'
            },
            {
                testNum: 619,
                testFunc: function () {
                    var o = '';

                    var root = XElement.parse("<r xml:space='preserve'/>");
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<r xml:space=\'preserve\'/>'
            },
            {
                testNum: 620,
                testFunc: function () {
                    var o = '';

                    var root = XElement.parse("<r><t xml:space='preserve'/></r>");
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<r>\n' +
                    '  <t xml:space=\'preserve\'/>\n' +
                    '</r>'
            },
            {
                testNum: 621,
                testFunc: function () {
                    var o = '';

                    var root = XElement.parse('<w:r xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">' +
                        '<w:rPr>' +
                        '<w:lang w:val="fr-FR" />' +
                        '</w:rPr>' +
                        '<w:tab />' +
                        '<w:t xml:space="preserve">Mark A. Rubin et al. </w:t>' +
                        '</w:r>');
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<w:r xmlns:w=\'http://schemas.openxmlformats.org/wordprocessingml/2006/main\'>\n' +
                    '  <w:rPr>\n' +
                    '    <w:lang w:val=\'fr-FR\'/>\n' +
                    '  </w:rPr>\n' +
                    '  <w:tab/>\n' +
                    '  <w:t xml:space=\'preserve\'>Mark A. Rubin et al. </w:t>\n' +
                    '</w:r>'
            },
            {
                testNum: 622,
                testFunc: function () {
                    var o = '';

                    var root = XElement.parse('<root>\u00A9</root>');
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<root>©</root>'
            },
            {
                testNum: 623,
                testFunc: function () {
                    var o = '';

                    var root = XElement.parse('<root>\u00AC\u221A</root>');
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<root>¬√</root>'
            },
            {
                testNum: 624,
                testFunc: function () {
                    var o = '';

                    var root = XElement.parse('<w:r xmlns:w=\'http://schemas.openxmlformats.org/wordprocessingml/2006/main\'>\n' +
                    '  <w:rPr>\n' +
                    '    <w:lang w:val=\'fr-FR\'/>\n' +
                    '  </w:rPr>\n' +
                    '  <w:tab/>\n' +
                    '  <w:t xml:space=\'preserve\'>Mark A. Rubin et al. </w:t>\n' +
                    '</w:r>');
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<w:r xmlns:w=\'http://schemas.openxmlformats.org/wordprocessingml/2006/main\'>\n' +
                    '  <w:rPr>\n' +
                    '    <w:lang w:val=\'fr-FR\'/>\n' +
                    '  </w:rPr>\n' +
                    '  <w:tab/>\n' +
                    '  <w:t xml:space=\'preserve\'>Mark A. Rubin et al. </w:t>\n' +
                    '</w:r>'
            },
            {
                testNum: 625,
                testFunc: function () {
                    var o = '';

                    var root = XElement.parse(
                        '<r><p><s>???</s> (<t>???</t>)</p></r>');
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<r>\n' +
                    '  <p><s>???</s> (<t>???</t>)</p>\n' +
                    '</r>'
            },
            {
                testNum: 626,
                testFunc: function () {
                    var o = '';

                    var root = XElement.parse(
                        '<r><s>aaa</s>bbb<t>ccc</t>)</r>');
                    var s = root.toString(true);
                    o = s;
                    return o;
                },
                output:
                    '<r><s>aaa</s>bbb<t>ccc</t>)</r>'
            },
            {
                testNum: 627,
                testFunc: function () {
                    var ns1 = Ltxml.XNamespace.getNone();
                    var e = Ltxml.XNamespace("http://www.ericwhite.com");

                    var x = new Ltxml.XElement(e + "root",
                        new Ltxml.XAttribute(Ltxml.XNamespace.getXmlns() + "e", e.namespaceName),
                        new Ltxml.XElement(e + "boo", "yar"),
                        new Ltxml.XElement(e + "yar", "boo"));
                    var o = '';
                    o += x.toString(true);
                    o += checkParentage(x);
                    return o;
                },
                output:
                    '<e:root xmlns:e=\'http://www.ericwhite.com\'>\n' +
                    '  <e:boo>yar</e:boo>\n' +
                    '  <e:yar>boo</e:yar>\n' +
                    '</e:root>'
            },
            {
                testNum: 999,
                testFunc: function () {
                    return '';
                },
                output:
                    ''
            }
        ];

        var testToRun = null;
        var dumpFunction = false;
        var dumpTestOutput = false;
        var startingTest = 1;
        var endingTest = 1000;

        bucketTimer.init();

        if (testToRun !== null) {
            var test = Enumerable.from(tests).firstOrDefault(function (t) { return t.testNum === testToRun; });
            runTest(test);
        }
        else {
            for (var i = 0; i < tests.length; i++) {
                var test = tests[i];
                var tn = test.testNum;
                if (tn >= startingTest && tn <= endingTest) {
                    Ltxml.clearCache();
                    runTest(test);
                }
            }
        }

        var s = bucketTimer.dump();
        document.writeln(s);

        function runTest(test) {
            var testNum = test.testNum;
            var to, to2, to3, to4;

            if (test !== null) {
                bucketTimer.bucket((testNum + 1000).toString().substring(1));
                document.writeln('Running test: ' + testNum);
                var outputFromRun = test.testFunc();
                while (outputFromRun.charAt(outputFromRun.length - 1) === '\n')
                    outputFromRun = outputFromRun.substring(0, outputFromRun.length - 1);
                to = test.output;
                while (to.charAt(to.length - 1) === '\n')
                    to = to.substring(0, to.length - 1);
                if (test.output2) {
                    to2 = test.output2;
                    while (to2.charAt(to2.length - 1) === '\n')
                        to2 = to2.substring(0, to2.length - 1);
                }
                if (test.output3) {
                    to3 = test.output3;
                    while (to3.charAt(to3.length - 1) === '\n')
                        to3 = to3.substring(0, to3.length - 1);
                }
                if (test.output4) {
                    to4 = test.output4;
                    while (to4.charAt(to4.length - 1) === '\n')
                        to4 = to4.substring(0, to4.length - 1);
                }

                var passed = (outputFromRun === to);
                if (test.output2)
                    passed |= (outputFromRun === to2);
                if (test.output3)
                    passed |= (outputFromRun === to3);
                if (test.output4)
                    passed |= (outputFromRun === to4);
                if (passed)
                    document.writeln("    PASSED");
                else {
                    document.writeln("    FAILED <=======================");
                    //document.writeln('outputFromRun.length: ' + outputFromRun.length);
                    //document.writeln('test.output.length: ' + test.output.length);
                }
                if (dumpFunction) {
                    if (dumpTestOutput || testToRun !== null || !passed) {
                        document.writeln("vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv");
                        document.writeln(convertToEntities(test.testFunc.toString()));
                        document.writeln("==================================================================");
                        document.writeln(convertToEntities(outputFromRun));
                        document.writeln("^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^");
                    }
                }
                else {
                    if (dumpTestOutput || testToRun !== null || !passed) {
                        document.writeln("vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv");
                        document.writeln(convertToEntities(outputFromRun));
                        document.writeln("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~");
                        document.writeln(convertToEntities(to));
                        document.writeln("^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^");
                    }
                }
                bucketTimer.bucket('other');
            }
        }
    } ());

</script>
</pre>
</body>
</html>
